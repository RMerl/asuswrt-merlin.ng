var m=new lang,g_storage=new myStorage,g_key_file=null,g_crt_file=null,g_intermediate_crt_file=null;
$("document").ready(function(){document.oncontextmenu=function(){return!1};var e=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),e=g_storage.get("lan")==void 0?e:g_storage.get("lan");m.setLanguage(e);var c=getUrlVar("p")==void 0?0:getUrlVar("p"),e=getUrlVar("s")==void 0?0:getUrlVar("s");$("ul.tabs li").eq(c).addClass("active");$(".tab_content").hide().eq(c).show();e&&$("ul.tabs li").each(function(a){a!=c&&$("ul.tabs li").eq(a).hide()});$("ul.tabs li").click(function(){var a=
$(this),b=a.find("a").attr("href");a.addClass("active").siblings(".active").removeClass("active");$(b).stop(!1,!0).fadeIn().siblings().hide();return!1}).find("a").focus(function(){this.blur()});$("button#btn_rescan").click(function(){$("button#btn_rescan").attr("disabled",!0);$("button#btn_rescan").text("Wait");parent.doRescanSamba()});$("button#btn_gen_crt").click(function(){var a=new davlib.DavClient;a.initialize();var b=g_storage.get("request_host_url");b.indexOf("://")!=-1&&(b=b.substr(b.indexOf("://")+
3));var c=m.getString("msg_gen_crt_confirm"),c=c.replace("%s",b);confirm(c)&&($("#crt_creating").show(),a.GENROOTCERTIFICATE("/",2048,"AiCloud","","TW","Taiwan","Hsinchu","ASUS","RD",b,function(b){b==200&&($("#crt_creating").hide(),alert(m.getString("msg_gen_crt_complete")),a.APPLYAPP("/","apply","","restart_webdav",function(b){b==200&&setTimeout(function(){parent.location.reload(!1)},6E3);a=null}))}))});$("button#btn_import_crt").click(function(){$("#import_crt").show();$("#import_crt").css("left",
g_mouse_x);g_mouse_y+$("#filelink").height()>$("body").height()?$("#import_crt").css("top",$("body").height()-$("#filelink").height()):$("#import_crt").css("top",g_mouse_y)});$("button#btn_export_crt").click(function(){window.open("/aicloud.crt")});$("li#rescan a").text(m.getString("title_rescan"));$("li#sharelink a").text(m.getString("title_sharelink"));$("li#version a").text(m.getString("title_version"));$("li#settings a").text(m.getString("title_crt"));$("li#account a").text(m.getString("title_account"));
$("button#ok").text(m.getString("btn_ok"));$("button#cancel").text(m.getString("btn_close"));$("#btn_rescan").text(m.getString("btn_rescan"));$("span#desc_rescan").text(m.getString("title_desc_rescan"));$("span#aicloud_desc_version").text("AiCloud "+m.getString("title_version"));$("span#aicloud_version").text(g_storage.get("aicloud_version"));$("span#smartsync_desc_version").text("SmartSync "+m.getString("title_version"));$("span#smartsync_version").text(g_storage.get("smartsync_version"));$("span#desc_version").text("FW "+
m.getString("title_version"));$("span#version").text(g_storage.get("router_version"));$("p.desc_share_link").text(m.getString("title_copy_string"));$("#label_gen_crt").text(m.getString("title_gen_crt"));$("#btn_gen_crt").text(m.getString("title_gen_crt"));$("#btn_import_crt").text(m.getString("title_import_crt"));$("#desc_gen_crt").text(m.getString("title_desc_gen_crt"));$("#label_server_crt").text(m.getString("title_server_crt"));$("#label_crt_type").text(m.getString("title_crt_type"));$("#label_self_crt_type").text(m.getString("title_self_crt_type"));
$("#label_crt_to").text(m.getString("title_crt_to"));$("#label_crt_from").text(m.getString("title_crt_from"));$("#label_crt_end_date").text(m.getString("title_crt_end_date"));$("#btn_export_crt").text(m.getString("title_export_crt"));$("#label_https_crt_cn").text(m.getString("https_crt_cn"));$("#crt_creating").text(m.getString("msg_gen_crt_creating"));$("#desc_import_crt").text(m.getString("desc_import_crt"));$("#label_select_private_key").text(m.getString("title_select_private_key"));$("#label_select_certificate").text(m.getString("title_select_certificate"));
$("#label_select_intermediate_certificate").text(m.getString("title_select_intermediate_certificate"));$("#import").text(m.getString("title_import_crt"));c==1?refreshShareLinkList():c==3&&refreshCertificateInfo();$(".abgne_tab").css("height",$(window).height()-80);$("#btn_select_key").change(function(a){a.target.files.length!=1?alert("Please select a key file!"):g_key_file=a.target.files[0]});$("#btn_select_crt").change(function(a){a.target.files.length!=1?alert("Please select a key file!"):g_crt_file=
a.target.files[0]});$("#btn_select_intermediate_crt").change(function(a){a.target.files.length==1&&(g_intermediate_crt_file=a.target.files[0])})});function onFacebookLogin(){}function facebook_login(){}function onGoogleLogin(){}function google_login(){}
function refreshShareLinkList(){var e=g_storage.get("webdav_mode"),c=g_storage.get("ddns_host_name"),a="",b=g_storage.get("request_host_url");b.indexOf("://")!=-1&&(b=b.substr(b.indexOf("://")+3));a=isPrivateIP(b)?c==""?b:c:b;a.indexOf(":")!=-1&&(a=a.substring(0,a.indexOf(":")));e==0?a="http://"+a+":"+g_storage.get("http_port"):(a="https://"+a,g_storage.get("https_port")!="443"&&(a+=":"+g_storage.get("https_port")));var f=new davlib.DavClient;f.initialize();f.GSLL("/",function(b,c,e){if(b==200){b=
parseXml(e);$("#tab2").empty();var d="<table id='sharelink' width='100%' border='0' style='table-layout:fixed'>";d+="<thead><tr>";d+="<th scope='col' class='check' style='width:5%'>";d+="<input type='checkbox' id='select_all' name='select_all' class='select_all'>";d+="</th>";d+="<th scope='col' class='filename' style='width:20%'>"+m.getString("table_filename")+"</th>";d+="<th scope='col' class='createtime' style='width:25%'>"+m.getString("table_createtime")+"</th>";d+="<th scope='col' class='expiretime' style='width:25%'>"+
m.getString("table_expiretime")+"</th>";d+="<th scope='col' class='lefttime' style='width:15%'>"+m.getString("table_lefttime")+"</th>";d+="<th scope='col' class='remove' style='width:10%'>"+m.getString("func_delete")+"</th>";d+="</tr></thead>";d+="<tbody id='ntb'>";var k=parseInt($(b).find("encode_filename").text()),h=0;$(b).find("sharelink").each(function(){try{var b="",c="";k==1?(b=$(this).attr("filename"),c=decodeURIComponent(b)):(c=$(this).attr("filename"),b=encodeURIComponent($(this).attr("filename")));
var e=a+"/"+$(this).attr("url")+"/"+b,f=$(this).attr("createtime"),g=$(this).attr("expiretime"),i=parseFloat($(this).attr("lefttime")),j=parseInt(i/3600),l=parseInt(i%3600/60);d+="<tr nid='"+h+"' class='even'>";d+="<td fid='check' align='center'><input type='checkbox' id='check_del' name='check_del' class='check_del' link=\""+$(this).attr("url")+'"></td>';d+="<td fid='filename' align='center'><div style='overflow:hidden;padding:5px;white-space:normal;word-break:break-all;text-align:left;'>";d+="<a class='share_link_url' uhref=\""+
e+"\" href='#' title=\""+c+'">'+c+"</a>";d+="</div></td>";d+="<td fid='createtime' align='center'>"+f+"</td>";g==0?(d+="<td fid='expiretime' align='center'>"+m.getString("title_unlimited")+"</td>",d+="<td fid='lefttime' align='center'>"+m.getString("title_unlimited")+"</td>"):(d+="<td fid='expiretime' align='center'>"+g+"</td>",d+="<td fid='lefttime' align='center'>"+j+" hours "+l+" mins</td>");d+="<td fid='remove' align='center'><a>";d+="<div class='dellink' title='remove' link=\""+$(this).attr("url")+
"\" style='cursor:pointer'></div>";d+="</a></td>";d+="</tr>"}catch(n){}h++});d+="</tbody>";d+="</table>";d+="<div class='delcheck_block'>";d+="<span>\u522a\u9664\u9078\u53d6\u9023\u7d50</span>";d+="</div>";$("#tab2").html(encodeSafeString(d));$("div.delcheck_block").css("visibility","hidden");$("a.share_link_url").click(function(){$("#filelink").css("display","block");$("#filelink").css("left",g_mouse_x);g_mouse_y+$("#filelink").height()>$("body").height()?$("#filelink").css("top",$("body").height()-
$("#filelink").height()):$("#filelink").css("top",g_mouse_y);$("#resourcefile").attr("value",$(this).attr("uhref"));$("#resourcefile").focus();$("#resourcefile").select()});$(".dellink").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&f.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})});$(".check_del").change(function(){var a=0;$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&a++});if(a<=0){var b=g_mouse_y+10,c=0;$("div.delcheck_block").animate({top:b,
left:c},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})}else $("div.delcheck_block").css("visibility",""),b=g_mouse_y+10,c=g_mouse_x+10,$("div.delcheck_block").animate({top:b,left:c},"fast")});$(".delcheck_block").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&($("div.delcheck_block").css("visibility","hidden"),$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&f.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})}))});
$("input.select_all").change(function(){if($(this).prop("checked")){$("input:checkbox.check_del").prop("checked",!0);$("div.delcheck_block").css("visibility","");var a=g_mouse_y+10,b=g_mouse_x+10;$("div.delcheck_block").animate({top:a,left:b},"fast")}else $("input:checkbox.check_del").prop("checked",!1),a=g_mouse_y+10,b=0,$("div.delcheck_block").animate({top:a,left:b},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})})}})}
function refreshCertificateInfo(){(g_storage.get("userpermission")==void 0?"":g_storage.get("userpermission"))=="admin"?$("#field_import_crt").show():$("#field_import_crt").hide();var e=new davlib.DavClient;e.initialize();e.GETX509CERTINFO("/",function(c,a,b){c==200&&(b=parseXml(b),c=$(b).find("issuer").text(),a=$(b).find("subject").text(),$(b).find("crt_start_date").text(),b=$(b).find("crt_end_date").text(),a!=""&&(a=a.substring(a.indexOf("CN=")+3,a.length),a.indexOf("/")!=-1&&(a=a.substring(0,a.indexOf("/")))),
c!=""&&(c=c.substring(c.indexOf("CN=")+3,c.length),c.indexOf("/")!=-1&&(c=c.substring(0,c.indexOf("/")))),b!=""&&(b=new Date(2E3+parseInt(b.substring(0,2)),parseInt(b.substring(2,4)),parseInt(b.substring(4,6))),b=b.getFullYear()+"-"+b.getMonth()+"-"+b.getDate()),c==a?$("#label_self_crt_type").text(m.getString("title_self_crt_type")):$("#label_self_crt_type").text(m.getString("title_third_crt_type")),$("#label_https_crt_cn").text(a),$("#label_https_crt_issuer").text(c),$("#label_https_crt_end_date").text(b),
c==""?$("#btn_export_crt").attr("disabled",!0):$("#btn_export_crt").attr("disabled",!1));e=null})}function doOK(){parent.closeJqmWindow()}function doCancel(){parent.closeJqmWindow()}function onCloseShareLink(){$("#filelink").css("display","none")}function onCloseImportCrt(){$("#import_crt").hide()}
function read_file(e,c){if(e!=null){var a=e.size-1,b=0,f=new FileReader;f.onloadend=function(a){a.target.readyState==FileReader.DONE&&c&&c(a,b)};e.webkitSlice?(a=e.webkitSlice(0,a+1),f.readAsText(a),b=1):e.mozSlice?(a=e.mozSlice(0,a+1),f.readAsBinaryString(a),b=0):(a=e.slice(0,a+1),f.readAsText(a),b=1)}}
function onDoImportCrt(){if(g_key_file==null)alert("Please select a key file.");else if(g_crt_file==null)alert("Please select a crt file.");else{var e="",c="",a="",b=function(){if(!(g_key_file!=null&&e=="")&&!(g_crt_file!=null&&c=="")&&!(g_intermediate_crt_file!=null&&a=="")){var b=new davlib.DavClient;b.initialize();b.SETROOTCERTIFICATE("/",e,c,a,function(a){a=="200"?($("#import_crt").hide(),alert(m.getString("msg_import_crt_complete")),b.APPLYAPP("/","apply","","restart_webdav",function(a){a==200&&
setTimeout(function(){parent.location.reload(!1)},6E3);b=null})):alert("Fail to import certificate file! Maybe the imported file is invalid, please check and try again.")},null)}};read_file(g_key_file,function(a){e=a.target.result;b()});read_file(g_crt_file,function(a){c=a.target.result;b()});read_file(g_intermediate_crt_file,function(c){a=c.target.result;b()})}}var g_mouse_x=0,g_mouse_y=0;document.onmousemove=getMouseXY;
function getMouseXY(e){document.all?(g_mouse_x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g_mouse_y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop):(g_mouse_x=e.pageX,g_mouse_y=e.pageY);g_mouse_x<0&&(g_mouse_x=0);g_mouse_y<0&&(g_mouse_y=0);return!0};
