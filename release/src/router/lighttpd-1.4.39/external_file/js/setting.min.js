var m=new lang,g_storage=new myStorage,server_url="http://oauth.asus.com/aicloud/",g_bLoginFacebook=!1,g_bLoginGoogle=!1,g_key_file=null,g_crt_file=null,g_intermediate_crt_file=null,g_create_account_dialog=null,g_account_info_dialog=null,g_invite_token="";
$("document").ready(function(){var e=getUrlVars(),b=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),b=g_storage.get("lan")==void 0?b:g_storage.get("lan");m.setLanguage(b);var b=e.s==void 0?0:e.s,a=e.p==void 0?0:e.p;$("ul.tabs li").eq(a).addClass("active");$(".tab_content").hide().eq(a).show();b&&$("ul.tabs li").each(function(d){d!=a&&$("ul.tabs li").eq(d).hide()});$("ul.tabs li").click(function(){var d=$(this),a=d.find("a").attr("href");d.addClass("active").siblings(".active").removeClass("active");
$(a).stop(!1,!0).fadeIn().siblings().hide();return!1}).find("a").focus(function(){this.blur()});$("button#btn_rescan").click(function(){$("button#btn_rescan").attr("disabled",!0);$("button#btn_rescan").text("Wait");parent.doRescanSamba()});$("button#btn_gen_crt").click(function(){var d=new davlib.DavClient;d.initialize();var a=g_storage.get("request_host_url");a.indexOf("://")!=-1&&(a=a.substr(a.indexOf("://")+3));var b=m.getString("msg_gen_crt_confirm"),b=b.replace("%s",a);confirm(b)&&($("#crt_creating").show(),
d.GENROOTCERTIFICATE("/",2048,"AiCloud","","TW","Taiwan","Hsinchu","ASUS","RD",a,function(a){a==200&&($("#crt_creating").hide(),alert(m.getString("msg_gen_crt_complete")),d.APPLYAPP("/","apply","","restart_webdav",function(a){a==200&&setTimeout(function(){parent.location.reload(!1)},6E3);d=null}))}))});$("button#btn_import_crt").click(function(){$("#import_crt").show();$("#import_crt").css("left",g_mouse_x);g_mouse_y+$("#filelink").height()>$("body").height()?$("#import_crt").css("top",$("body").height()-
$("#filelink").height()):$("#import_crt").css("top",g_mouse_y)});$("button#btn_export_crt").click(function(){window.open("/aicloud.crt")});$("button#btn_create_account").click(function(){g_create_account_dialog.data("action","new").dialog("open")});$("button#btn_create_invite").click(function(){g_create_account_dialog.data("action","invite").dialog("open")});$("li#rescan a").text(m.getString("title_rescan"));$("li#sharelink a").text(m.getString("title_sharelink"));$("li#version a").text(m.getString("title_version"));
$("li#settings a").text(m.getString("title_crt"));$("li#account a").text(m.getString("title_account"));$("button#ok").text(m.getString("btn_ok"));$("button#cancel").text(m.getString("btn_close"));$("#btn_rescan").text(m.getString("btn_rescan"));$("span#desc_rescan").text(m.getString("title_desc_rescan"));$("span#aicloud_desc_version").text("AiCloud "+m.getString("title_version"));$("span#aicloud_version").text(g_storage.get("aicloud_version"));$("span#smartsync_desc_version").text("SmartSync "+m.getString("title_version"));
$("span#smartsync_version").text(g_storage.get("smartsync_version"));$("span#desc_version").text("FW "+m.getString("title_version"));$("span#version").text(g_storage.get("router_version"));$("p.desc_share_link").text(m.getString("title_copy_string"));$("#label_gen_crt").text(m.getString("title_gen_crt"));$("#btn_gen_crt").text(m.getString("title_gen_crt"));$("#btn_import_crt").text(m.getString("title_import_crt"));$("#desc_gen_crt").text(m.getString("title_desc_gen_crt"));$("#label_server_crt").text(m.getString("title_server_crt"));
$("#label_crt_type").text(m.getString("title_crt_type"));$("#label_self_crt_type").text(m.getString("title_self_crt_type"));$("#label_crt_to").text(m.getString("title_crt_to"));$("#label_crt_from").text(m.getString("title_crt_from"));$("#label_crt_end_date").text(m.getString("title_crt_end_date"));$("#btn_export_crt").text(m.getString("title_export_crt"));$("#label_https_crt_cn").text(m.getString("https_crt_cn"));$("#crt_creating").text(m.getString("msg_gen_crt_creating"));$("#desc_import_crt").text(m.getString("desc_import_crt"));
$("#label_select_private_key").text(m.getString("title_select_private_key"));$("#label_select_certificate").text(m.getString("title_select_certificate"));$("#label_select_intermediate_certificate").text(m.getString("title_select_intermediate_certificate"));$("#import").text(m.getString("title_import_crt"));$("#label_create_account").text(m.getString("title_create_account"));$("#desc_create_account").text(m.getString("title_desc_create_account"));$("#btn_create_account").text(m.getString("title_create_account"));
$("#btn_create_invite").text(m.getString("title_invite_account"));$("#label_username").text(m.getString("title_username"));$("#label_password").text(m.getString("title_password"));$("#label_password_confirm").text(m.getString("title_password_confirm"));$("#label_size_limit").text(m.getString("title_size_limit"));$("#label_access_permission").text(m.getString("title_access_permission"));$("#label_account_list").text(m.getString("title_account_list"));$("#table_account_list td[field=username]").text(m.getString("title_username"));
$("#table_account_list td[field=type]").text(m.getString("title_type"));$("#table_account_list td[field=edit]").text(m.getString("title_edit"));$("#table_account_list td[field=delete]").text(m.getString("title_delete"));$("#label_account_invite_list").text(m.getString("title_account_invite_list"));$("#table_account_invite_list td[field=invite]").text(m.getString("title_invite"));$("#table_account_invite_list td[field=createtime]").text(m.getString("title_create_time"));$("#table_account_invite_list td[field=edit]").text(m.getString("title_edit"));
$("#table_account_invite_list td[field=delete]").text(m.getString("title_delete"));$("#label_security_code").text(m.getString("title_security_code"));$("#select_security_code option[value=0]").text(m.getString("title_security_code_type_none"));$("#select_security_code option[value=1]").text(m.getString("title_security_code_type_manually"));$("#select_security_code option[value=2]").text(m.getString("title_security_code_type_auto"));$("#label_smart_access").text(m.getString("title_smart_access"));
$("#span_smart_access").text(m.getString("title_enable"));a==1?refreshShareLinkList():a==3&&refreshCertificateInfo();$(".abgne_tab").css("height",$(window).height()-80);$("#facebook .user_login_option").click(function(){g_bLoginFacebook||facebook_login()});$("#google .user_login_option").click(function(){g_bLoginGoogle||google_login()});$("#btn_select_key").change(function(a){a.target.files.length!=1?alert("Please select a key file!"):g_key_file=a.target.files[0]});$("#btn_select_crt").change(function(a){a.target.files.length!=
1?alert("Please select a key file!"):g_crt_file=a.target.files[0]});$("#btn_select_intermediate_crt").change(function(a){a.target.files.length==1&&(g_intermediate_crt_file=a.target.files[0])});$("#select_security_code").change(function(){$(this).val()==1?$("#input_security_code").show():$("#input_security_code").hide()});g_create_account_dialog=$("#dialog_create_account").dialog({autoOpen:!1,height:500,width:600,modal:!0,buttons:{OK:function(){var a=myencodeURI(String($("#input_username").val()).trim()),
b=String($("#input_password").val()).trim(),f=String($("#input_password_confirm").val()).trim(),e="aicloud",g=$(this).data("action"),c=-1;if(g!="invite"&&g!="modify_invite"){if(a==""){alert(m.getString("msg_err_account_blank"));return}if(b!=f){alert(m.getString("msg_err_password_matched"));return}}f=new davlib.DavClient;f.initialize();g=="modify"&&(c=parseInt($(this).data("id")));var l="",i;for(i in g_folder_permission_info)if(g_folder_permission_info.hasOwnProperty(i))for(var n in g_folder_permission_info[i])if(g_folder_permission_info[i].hasOwnProperty(n)){var p=
g_folder_permission_info[i][n];l+=myencodeURI(i)+","+myencodeURI(n)+","+p;l+=";"}a=encodeURIComponent(a);b=encodeURIComponent(b);e=encodeURIComponent(e);l=encodeURIComponent(l);if(g=="invite"||g=="modify_invite"){var j="";if($("#select_security_code").val()==0)j="";else if($("#select_security_code").val()==1){if(j=$("#input_security_code").val(),j==""){alert("Please input security code!");return}}else $("#select_security_code").val()==2&&(j=Math.floor(1E3+Math.random()*9E3));var o=$("#input_smart_access").prop("checked")==
!0?1:0;f.UPDATEACCOUNTINVITE("/",g_invite_token,l,o,j,function(a,c,d){a==200?(a=parseXml(d),a=$(a).find("token").text(),g_create_account_dialog.dialog("close"),query_account_invite_list(),g=="invite"&&g_account_info_dialog.data("action","invite").data("invite_token",a).data("enable_smart_access",o).data("security_code",j).dialog("open")):alert(m.getString("msg_err_account_create"))},null)}else f.UPDATEACCOUNT("/",c,a,b,e,l,function(a,c,d){a==200?d=="ACCOUNT_IS_EXISTED"?alert(m.getString("msg_err_account_existed")):
(set_account_input_default_val(),g_create_account_dialog.dialog("close"),query_account_list()):alert(m.getString("msg_err_account_create"))},null)},CANCEL:function(){g_create_account_dialog.dialog("close")}},close:function(){},open:function(){$("#dialog_create_account .ui-button-text:contains(OK)").text(m.getString("btn_ok"));$("#dialog_create_account .ui-button-text:contains(CANCEL)").text(m.getString("btn_cancel"));var a=$(this).data("action");if(a=="modify"){parseInt($(this).data("id"));a=$(this).data("username");
$(this).data("usertype");$("#dialog_create_account").dialog("option","title",m.getString("title_update_account"));$("#input_username").attr("disabled",!0);var b=new davlib.DavClient;b.initialize();b.GETACCOUNTINFO("/",a,function(a,d,c){a==200&&(a=parseXml(c),c=$(a),a=c.find("username").text(),d=c.find("type").text(),c.find("permission").text(),c=c.find("password").text(),$(".option_account").show(),$(".option_invite").hide(),$("#input_username").val(a),$("#input_password").val(c),$("#input_password_confirm").val(c),
$("#table_share_folder").css("height",220),query_partition_share_folder(d,a,g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0))},null)}else if(a=="new")$("#dialog_create_account").dialog("option","title",m.getString("title_create_account")),$(".option_account").show(),$(".option_invite").hide(),$("#input_username").attr("disabled",!1),$("#input_username").val(""),$("#input_password").val(""),$("#input_password_confirm").val(""),$("#input_name").val(""),$("#table_share_folder").css("height",
220),query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0);else if(a=="invite")$("#dialog_create_account").dialog("option","title",m.getString("title_invite_account")),$(".option_account").hide(),$(".option_invite").show(),$("#table_share_folder").css("height",280),g_invite_token="",query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0);else if(a=="modify_invite"){var e=$(this).data("token"),
b=new davlib.DavClient;b.initialize();b.GETACCOUNTINVITEINFO("/",e,function(a,d,c){a==200&&(a=parseXml(c),d=$(a),d.find("permission").text(),a=parseInt(d.find("smart_access").text()),d=d.find("security_code").text(),g_invite_token=e,$(".option_account").hide(),$(".option_invite").show(),$("#table_share_folder").css("height",280),$("#input_smart_access").prop("checked",a==1?!0:!1),d==""?($("#select_security_code").val(0),$("#input_security_code").hide()):($("#select_security_code").val(1),$("#input_security_code").show(),
$("#input_security_code").val(d)),query_partition_share_folder("","",g_storage.get("usbdiskname"),g_storage.get("usbdiskname"),"table_share_folder",0))},null)}}});g_account_info_dialog=$("#dialog_account_info").dialog({autoOpen:!1,height:500,width:600,modal:!0,buttons:{OK:function(){g_account_info_dialog.dialog("close")}},open:function(){var a=$(this).data("action"),b=$(this).data("invite_token"),e=$(this).data("enable_smart_access"),h=$(this).data("security_code");if(a=="invite"){a="";g_storage.get("ddns_host_name")==
""?a=g_storage.get("request_host_url")+"/"+b:(a="https://"+g_storage.get("ddns_host_name"),g_storage.get("https_port")!="443"&&(a+=":"+g_storage.get("https_port")),a+="/"+b);var b=m.getString("msg_invitation_desc1"),e=m.getString("title_smart_access")+": "+(e==1?m.getString("title_enable"):m.getString("title_disable")),h=m.getString("title_security_code")+": "+(h==""||h=="none"?m.getString("title_security_code_type_none"):h),g=b.replace(/\n/g,"<br><br>");g+='<a style="color:#ff0000" href="'+a+'" target="_blank">'+
a+"</a>";g+="<br><br>"+e;g+="<br><br>"+h;$("#account_info").html(encodeSafeString(g));g="mailto:?subject=Welcome to my AiCloud";g+="&body=";g+=encodeURIComponent(b);g+=encodeURIComponent(a);g+=encodeURIComponent("\n"+e);g+=encodeURIComponent("\n"+h);$("#mail_invitation").attr("href",g)}}});query_account_list();query_account_invite_list()});var g_folder_permission_info=[];
function query_partition_share_folder(e,b,a,d,k,f){if(!(f>1)){var h={action:"query_disk_folder",id:"#"};h.path=a;h.type=e;h.account=b;$.ajax({url:"/query_field.json",data:h,type:"GET",dataType:"json",timeout:2E4,error:function(){alert("Error loading json data!")},success:function(g){var c="<table class='tree_table'>";f+=1;for(var l=0;l<g.length;l++){var i=g[l].text,n=parseInt(g[l].permission),h=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),j=h+"_"+l;f==1?(c+="<tr class='partion_table_tr' style='background-color:#989898;color:#ffffff'>",
c+="<td>",c+=i,c+="</td>",c+="<td></td>",c+="</tr>",g_folder_permission_info[i]=[]):f==2&&(c+="<tr class='folder_table_tr' style='border-bottom:1px solid #989898'>",c+="<td style='padding-left:10px'>",c+=i,c+="</td>",c+="<td style='width:150px;'>",c+="<div id='f"+j+"' data-id='"+j+"' class='FileStatus' data-partition='"+d+"' data-folder='"+i+"'>",c+="<table>",c+="<tr data-permission='"+n+"'>",c+="<td><input type='radio' class='radio_permission' name='g"+j+"' id='g"+j+"' value='3'"+(n==3?" checked":
"")+">R/W</td>",c+="<td><input type='radio' class='radio_permission' name='g"+j+"' id='g"+j+"' value='1'"+(n==1?" checked":"")+">R</td>",c+="<td><input type='radio' class='radio_permission' name='g"+j+"' id='g"+j+"' value='0'"+(n==0||n==-1?" checked":"")+">N</td>",c+="</tr>",c+="</table>",c+="</div>",c+="</td>",c+="</tr>",g_folder_permission_info[d][i]=n);n="table_"+h;c+="<tr><td colspan='2'><div id='"+n+"'></div></td></tr>";query_partition_share_folder(e,b,a+"/"+i,i,n,f)}c+="</table>";$("#"+k).html(encodeSafeString(c));
$(".folder_table_tr").mouseenter(function(){$(this).css("background-color","#cccccc")});$(".folder_table_tr").mouseleave(function(){$(this).css("background-color","transparent")});$(".radio_permission").change(function(){$(this).closest(".FileStatus").attr("data-id");var a=$(this).closest(".FileStatus").attr("data-partition"),c=$(this).closest(".FileStatus").attr("data-folder"),b=parseInt($(this).val());g_folder_permission_info[a][c]=b})}})}}
function set_account_input_default_val(){$("#input_username").val("");$("#input_password").val("");$("#input_password_confirm").val("");$("#input_name").val("")}
function query_account_list(){var e=new davlib.DavClient;e.initialize();e.GETACCOUNTLIST("/",function(b,a,d){if(b==200){b=parseXml(d);b=$(b).find("account");a="";for(d=0;d<b.length;d++){var e=parseXml(b[d]),f=$(e),e=f.find("id").text(),h=f.find("username").text(),f=f.find("type").text();a+="<tr data-acid='"+e+"' data-username='"+h+"' data-usertype='"+f+"'>";a+="<td>";a+=h;a+="</td>";a+="<td>";a+=f;a+="</td>";a+="<td align='center'>";f=="aicloud"&&(a+="<input class='edit_account' type='button' value='"+
m.getString("title_edit")+"'/>");a+="</td>";a+="<td align='center'>";f=="aicloud"&&(a+="<input class='delete_account' type='button' value='"+m.getString("title_delete")+"'/>");a+="</td>";a+="</tr>"}$("#table_account_list tbody").empty();$("#table_account_list tbody").append(encodeSafeString(a));$(".edit_account").click(function(){var a=$(this).closest("tr"),c=a.attr("data-acid"),b=a.attr("data-username"),a=a.attr("data-usertype");g_create_account_dialog.data("action","modify").data("id",c).data("username",
b).data("usertype",a).dialog("open")});$(".delete_account").click(function(){var a=$(this).closest("tr");a.attr("data-acid");var a=a.attr("data-username"),c=m.getString("msg_delete_account"),c=c.replace("%s",a);confirm(c)&&(c=new davlib.DavClient,c.initialize(),c.DELETEACCOUNT("/",a,function(a){a==200?query_account_list():alert("Fail to delete account.")},null))})}},null)}
function query_account_invite_list(){g_storage.get("request_host_url");g_storage.get("ddns_host_name")!=""&&g_storage.get("ddns_host_name");var e=new davlib.DavClient;e.initialize();e.GETACCOUNTINVITELIST("/",function(b,a,d){if(b==200){b=parseXml(d);b=$(b).find("invite");a="";for(d=0;d<b.length;d++){var e=parseXml(b[d]),f=$(e),e=f.find("id").text(),h=f.find("token").text(),g=f.find("timestamp").text(),c=f.find("smart_access").text(),f=f.find("security_code").text();a+="<tr data-aciid='"+e+"' data-token='"+
h+"' data-smart-access='"+c+"' data-security-code='"+f+"'>";a+="<td>";a+="<a href='#' class='show_account_invite_info'>";a+=h;a+="</a>";a+="</td>";a+="<td>";a+=g;a+="</td>";a+="<td align='center'>";a+="<input class='edit_account_invite' type='button' value='"+m.getString("title_edit")+"'/>";a+="</td>";a+="<td align='center'>";a+="<input class='delete_account_invite' type='button' value='"+m.getString("title_delete")+"'/>";a+="</td>";a+="</tr>"}$("#table_account_invite_list tbody").empty();$("#table_account_invite_list tbody").append(encodeSafeString(a));
$(".edit_account_invite").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");a=a.attr("data-token");g_create_account_dialog.data("action","modify_invite").data("token",a).dialog("open")});$(".delete_account_invite").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");var a=a.attr("data-token"),c=m.getString("msg_delete_account_invite");confirm(c)&&(c=new davlib.DavClient,c.initialize(),c.DELETEACCOUNTINVITE("/",a,function(a){a==200?query_account_invite_list():alert("Fail to delete account invite.")},
null))});$(".show_account_invite_info").click(function(){var a=$(this).closest("tr");a.attr("data-aciid");var c=a.attr("data-token"),b=a.attr("data-smart-access"),a=a.attr("data-security-code");g_account_info_dialog.data("action","invite").data("invite_token",c).data("enable_smart_access",b).data("security_code",a).dialog("open")})}},null)}function onFacebookLogin(e,b){alert(e+", "+b)}function facebook_login(){}function onGoogleLogin(e,b){alert(e+", "+b)}function google_login(){}
function getLatestVersion(){var e=new davlib.DavClient;e.initialize();$("#update").text(m.getString("msg_check_latest_ver"));e.GETLATESTVER("/",function(b,a,d){b==200?(b=parseXml(d),b=$(b).find("version").text().split("_")[1],a=g_storage.get("router_version").split(".")[3],b>a?$("#update").text(m.getString("msg_update_latest_ver")):$("#update").text(m.getString("msg_latest_ver"))):$("#update").text(m.getString("msg_check_latest_ver_error"));e=null})}
function refreshShareLinkList(){var e=g_storage.get("webdav_mode"),b=g_storage.get("ddns_host_name"),a="",d=g_storage.get("request_host_url");d.indexOf("://")!=-1&&(d=d.substr(d.indexOf("://")+3));a=isPrivateIP(d)?b==""?d:b:d;a.indexOf(":")!=-1&&(a=a.substring(0,a.indexOf(":")));e==0?a="http://"+a+":"+g_storage.get("http_port"):(a="https://"+a,g_storage.get("https_port")!="443"&&(a+=":"+g_storage.get("https_port")));var k=new davlib.DavClient;k.initialize();k.GSLL("/",function(b,d,e){if(b==200){b=
parseXml(e);$("#tab2").empty();var c="<table id='sharelink' width='100%' border='0' style='table-layout:fixed'>";c+="<thead><tr>";c+="<th scope='col' class='check' style='width:5%'>";c+="<input type='checkbox' id='select_all' name='select_all' class='select_all'>";c+="</th>";c+="<th scope='col' class='filename' style='width:20%'>"+m.getString("table_filename")+"</th>";c+="<th scope='col' class='createtime' style='width:25%'>"+m.getString("table_createtime")+"</th>";c+="<th scope='col' class='expiretime' style='width:25%'>"+
m.getString("table_expiretime")+"</th>";c+="<th scope='col' class='lefttime' style='width:15%'>"+m.getString("table_lefttime")+"</th>";c+="<th scope='col' class='remove' style='width:10%'>"+m.getString("func_delete")+"</th>";c+="</tr></thead>";c+="<tbody id='ntb'>";var l=parseInt($(b).find("encode_filename").text()),i=0;$(b).find("sharelink").each(function(){try{var b="",d="";l==1?(b=$(this).attr("filename"),d=decodeURIComponent(b)):(d=$(this).attr("filename"),b=encodeURIComponent($(this).attr("filename")));
var e=a+"/"+$(this).attr("url")+"/"+b,f=$(this).attr("createtime"),g=$(this).attr("expiretime"),k=parseFloat($(this).attr("lefttime")),h=parseInt(k/3600),q=parseInt(k%3600/60);c+="<tr nid='"+i+"' class='even'>";c+="<td fid='check' align='center'><input type='checkbox' id='check_del' name='check_del' class='check_del' link=\""+$(this).attr("url")+'"></td>';c+="<td fid='filename' align='center'><div style='overflow:hidden;padding:5px;white-space:normal;word-break:break-all;text-align:left;'>";c+="<a class='share_link_url' uhref=\""+
e+"\" href='#' title=\""+d+'">'+d+"</a>";c+="</div></td>";c+="<td fid='createtime' align='center'>"+f+"</td>";g==0?(c+="<td fid='expiretime' align='center'>"+m.getString("title_unlimited")+"</td>",c+="<td fid='lefttime' align='center'>"+m.getString("title_unlimited")+"</td>"):(c+="<td fid='expiretime' align='center'>"+g+"</td>",c+="<td fid='lefttime' align='center'>"+h+" hours "+q+" mins</td>");c+="<td fid='remove' align='center'><a>";c+="<div class='dellink' title='remove' link=\""+$(this).attr("url")+
"\" style='cursor:pointer'></div>";c+="</a></td>";c+="</tr>"}catch(r){}i++});c+="</tbody>";c+="</table>";c+="<div class='delcheck_block'>";c+="<span>\u522a\u9664\u9078\u53d6\u9023\u7d50</span>";c+="</div>";$("#tab2").html(encodeSafeString(c));$("div.delcheck_block").css("visibility","hidden");$("a.share_link_url").click(function(){$("#filelink").css("display","block");$("#filelink").css("left",g_mouse_x);g_mouse_y+$("#filelink").height()>$("body").height()?$("#filelink").css("top",$("body").height()-
$("#filelink").height()):$("#filelink").css("top",g_mouse_y);$("#resourcefile").attr("value",$(this).attr("uhref"));$("#resourcefile").focus();$("#resourcefile").select()});$(".dellink").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&k.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})});$(".check_del").change(function(){var a=0;$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&a++});if(a<=0){var b=g_mouse_y+10,c=0;$("div.delcheck_block").animate({top:b,
left:c},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})}else $("div.delcheck_block").css("visibility",""),b=g_mouse_y+10,c=g_mouse_x+10,$("div.delcheck_block").animate({top:b,left:c},"fast")});$(".delcheck_block").click(function(){confirm(m.getString("msg_confirm_delete_sharelink"))==!0&&($("div.delcheck_block").css("visibility","hidden"),$("input:checkbox.check_del").each(function(){$(this).prop("checked")&&k.REMOVESL("/",$(this).attr("link"),function(a){a==200&&refreshShareLinkList()})}))});
$("input.select_all").change(function(){if($(this).prop("checked")){$("input:checkbox.check_del").prop("checked",!0);$("div.delcheck_block").css("visibility","");var a=g_mouse_y+10,b=g_mouse_x+10;$("div.delcheck_block").animate({top:a,left:b},"fast")}else $("input:checkbox.check_del").prop("checked",!1),a=g_mouse_y+10,b=0,$("div.delcheck_block").animate({top:a,left:b},"fast",function(){$("div.delcheck_block").css("visibility","hidden")})})}})}
function refreshCertificateInfo(){(g_storage.get("userpermission")==void 0?"":g_storage.get("userpermission"))=="admin"?$("#field_import_crt").show():$("#field_import_crt").hide();var e=new davlib.DavClient;e.initialize();e.GETX509CERTINFO("/",function(b,a,d){b==200&&(d=parseXml(d),b=$(d).find("issuer").text(),a=$(d).find("subject").text(),$(d).find("crt_start_date").text(),d=$(d).find("crt_end_date").text(),a!=""&&(a=a.substring(a.indexOf("CN=")+3,a.length),a.indexOf("/")!=-1&&(a=a.substring(0,a.indexOf("/")))),
b!=""&&(b=b.substring(b.indexOf("CN=")+3,b.length),b.indexOf("/")!=-1&&(b=b.substring(0,b.indexOf("/")))),d!=""&&(d=new Date(2E3+parseInt(d.substring(0,2)),parseInt(d.substring(2,4)),parseInt(d.substring(4,6))),d=d.getFullYear()+"-"+d.getMonth()+"-"+d.getDate()),b==a?$("#label_self_crt_type").text(m.getString("title_self_crt_type")):$("#label_self_crt_type").text(m.getString("title_third_crt_type")),$("#label_https_crt_cn").text(a),$("#label_https_crt_issuer").text(b),$("#label_https_crt_end_date").text(d),
b==""?$("#btn_export_crt").attr("disabled",!0):$("#btn_export_crt").attr("disabled",!1));e=null})}function doOK(){parent.closeJqmWindow()}function doCancel(){parent.closeJqmWindow()}function onCloseShareLink(){$("#filelink").css("display","none")}function onCloseImportCrt(){$("#import_crt").hide()}
function read_file(e,b){if(e!=null){var a=e.size-1,d=0,k=new FileReader;k.onloadend=function(a){a.target.readyState==FileReader.DONE&&b&&b(a,d)};e.webkitSlice?(a=e.webkitSlice(0,a+1),k.readAsText(a),d=1):e.mozSlice?(a=e.mozSlice(0,a+1),k.readAsBinaryString(a),d=0):(a=e.slice(0,a+1),k.readAsText(a),d=1)}}
function onDoImportCrt(){if(g_key_file==null)alert("Please select a key file.");else if(g_crt_file==null)alert("Please select a crt file.");else{var e="",b="",a="",d=function(){if(!(g_key_file!=null&&e=="")&&!(g_crt_file!=null&&b=="")&&!(g_intermediate_crt_file!=null&&a=="")){var d=new davlib.DavClient;d.initialize();d.SETROOTCERTIFICATE("/",e,b,a,function(a){a=="200"?($("#import_crt").hide(),alert(m.getString("msg_import_crt_complete")),d.APPLYAPP("/","apply","","restart_webdav",function(a){a==200&&
setTimeout(function(){parent.location.reload(!1)},6E3);d=null})):alert("Fail to import certificate file! Maybe the imported file is invalid, please check and try again.")},null)}};read_file(g_key_file,function(a){e=a.target.result;d()});read_file(g_crt_file,function(a){b=a.target.result;d()});read_file(g_intermediate_crt_file,function(b){a=b.target.result;d()})}}var g_mouse_x=0,g_mouse_y=0;document.onmousemove=getMouseXY;
function getMouseXY(e){document.all?(g_mouse_x=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g_mouse_y=event.clientY+document.body.scrollTop+document.documentElement.scrollTop):(g_mouse_x=e.pageX,g_mouse_y=e.pageY);g_mouse_x<0&&(g_mouse_x=0);g_mouse_y<0&&(g_mouse_y=0);return!0};
