var g_storage=new myStorage,m=new lang,g_modal_url,g_modal_window_width=200,g_modal_window_height=80,g_show_modal=0,g_folder_array,g_file_array,g_root_path="",g_sharelink_openurl_key="",g_image_player_setting=null,client=new davlib.DavClient;client.initialize();function closeJqmWindow(){var d=$("div#modalWindow");$("iframe",d).attr("src","");d&&d.jqmHide()}function resizeJqmWindow(d,c){var b=$(".jqmWindow");b&&(b.css("width",d+"px"),b.css("height",c+"px"))}
function onMouseDownPicDIVHandler(d){if(d.button==2)return!1;openSelItem($(this).parents(".thumb-table-parent").find("a#list_item"))}
function openAudioPlayer(d){for(var c=[],b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].furl)=="mp3"&&c.push(g_file_array[b]);if(c.length==0)alert("No audio files");else{for(var e="",a=0,b=0;b<c.length;b++){var k=c[b].furl;d==k&&(a=b);e+=k;b!=c.length-1&&(e+=",")}c=$("div#modalWindow");g_modal_url="/smb/css/audio.html?a="+d+"&alist="+e+"&index="+a+"&s=0";g_modal_window_width=480;g_modal_window_height=160;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_audioplayer"));
c&&c.jqmShow()}}
function openImageViewer(d){for(var c=[],b=0;b<g_file_array.length;b++){var e=getFileExt(g_file_array[b].furl);(e=="jpg"||e=="jpeg"||e=="png"||e=="gif")&&c.push(g_file_array[b])}if(c.length==0)alert(m.getString("msg_no_image_list"));else{for(b=e=0;b<c.length;b++)d==c[b].furl&&(e=b);d="";b=getPageSize();d+='<div id="image_slide_show" class="barousel unselectable" style="height: 0; width: 0; position: fixed; background-color: rgb(0, 0, 0); left: '+b[0]/2+"px; top: "+b[1]/2+'px; z-index: 2999;">';d+=
'<div class="barousel_image">';for(b=0;b<c.length;b++){var a=c[b].furl;d+=b==e?'<img src="" path="'+a+'" alt="" class="default"/>':'<img src="" path="'+a+'" alt="" class=""/>'}d+="</div>";d+='<div class="barousel_nav">';d+='<div class="barousel_content transparent" style="display: block; ">';for(b=0;b<c.length;b++)d+='<div class="',b==e&&(d+="default"),d+='" style="display: none; ">',d+='<p class="header">'+c[b].name+"</p>",d+="</div>";d+="</div>";d+="</div>";d+='<div class="barousel_loading" style="position:absolute;display:none;z-index=99;"><img src="/smb/css/load.gif" width="18px" height="18px"/></div>';
d+="</div>";$(d).animate({width:"100%",height:"100%",left:"0px",top:"0px"},200,null,null).appendTo("body");$("#image_slide_show").barousel({name:"image_slide_show",manualCarousel:1,contentResize:0,startIndex:e,storage:g_storage,stringTable:m,enableExifFunc:0,enableShareFunc:0,closeHandler:function(){g_image_player_setting=null},initCompleteHandler:function(a){g_image_player_setting=a}});c=null}}
function openSelItem(d){var c=d.attr("uhref");d.attr("qtype");var b=d.attr("isdir");d.attr("isusb");var e=d.attr("uhref");d.attr("title");d=getFileExt(c);if(d=="mp4")if(isBrowser("msie")&&getInternetExplorerVersion()<=8)window.open(c);else{c=$("div#modalWindow");d="/smb/css/vlc_video.html?v="+e;d+="&showbutton=1";e=[];for(b=0;b<g_file_array.length;b++)getFileExt(g_file_array[b].furl)=="srt"&&e.push(g_file_array[b].furl);if(e.length>0){d+="&s=";for(b=0;b<e.length;b++)d+=e[b],b!=e.length-1&&(d+=";")}g_modal_url=
d;g_modal_window_width=655;g_modal_window_height=580;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_videoplayer"));c&&c.jqmShow()}else if(d=="mp3")openAudioPlayer(c);else{if(d=="doc"||d=="docx"||d=="ppt"||d=="pptx"||d=="xls"||d=="xlsx"||d=="pdf")if((isWinOS()||isMacOS())&&!isPrivateIP()){window.open("https://docs.google.com/viewer?url="+c);return}d=="jpg"||d=="jpeg"||d=="png"||d=="gif"?openImageViewer(c):b==1?doPROPFIND(c,!1,null,0):window.open(c)}}
function sortByName(d,c){var b=d.name.toLowerCase(),e=c.name.toLowerCase();return b<e?-1:b>e?1:0}
function createThumbView(d,c,b,e){var a="";$("div#fileview").empty();if(d!=2){var k=decodeURI(c),E=decodeURI(g_root_path);k.indexOf(E)!=-1&&(a+='<div class="albumDiv">',a+='<table class="thumb-table-parent">',a+="<tbody>",a+="<tr><td>",a+='<div class="picDiv" isParent="1" popupmenu="0" uhref="',a+=c,a+='">',a+='<div class="parentDiv bicon"></div></div>',a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo">',a+='<a id="list_item" qtype="1" isdir="1" uhref="',a+=c,a+='" title="'+m.getString("btn_prevpage")+
'" online="0">'+m.getString("btn_prevpage"),a+="</a>",a+="</div>",a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>");for(c=0;c<b.length;c++)k=m.getString("table_filename")+": "+b[c].name,b[c].time!=""&&(k+="\n"+m.getString("table_time")+": "+b[c].time),a+='<div class="albumDiv" ',a+=' title="',a+=k,a+='">',a+='<table class="thumb-table-parent">',a+="<tbody>",a+="<tr><td>",a+='<div class="picDiv" popupmenu="',a+=d=="0"?"1":"0",a+='" uhref="',a+=b[c].furl,a+='">',a+=d=="2"?b[c].type=="usbdisk"?
'<div id="fileviewicon" class="usbDiv bicon">':b[c].online=="1"?'<div id="fileviewicon" class="computerDiv bicon">':'<div id="fileviewicon" class="computerOffDiv bicon">':'<div id="fileviewicon" class="folderDiv bicon">',b[c].routersyncfolder=="1"&&(a+='<div id="routersyncicon" class="routersyncDiv sicon"></div>'),a+='<div class="selectDiv sicon"></div>',a+='<div class="selectHintDiv sicon"></div>',a+="</div></div>",a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo">',a+='<a id="list_item" qtype="',
a+=d,a+='" isdir="1" uhref="',a+=b[c].furl,a+='" title="',a+=b[c].name,a+='" online="',a+=b[c].online,a+='" ip="" mac="',a+=b[c].mac,a+='" uid="',a+=b[c].uid,a+='" freadonly="',a+=b[c].freadonly,a+='" fhidden="',a+=b[c].fhidden,a+=b[c].type=="usbdisk"?'" isusb="1"':'" isusb="0"',a+='">',a+=b[c].shortname,b[c].online=="0"&&d=="2"&&(a+="("+m.getString("title_offline")+")"),a+="</a>",a+="</div>",a+="</td></tr>",a+="<tr><td>",a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>";for(c=0;c<e.length;c++)k=
m.getString("table_filename")+": "+e[c].name+"\n"+m.getString("table_time")+": "+e[c].time+"\n"+m.getString("table_size")+": "+e[c].size,a+='<div class="albumDiv"',a+=' title="',a+=k,a+='">',a+='<table class="thumb-table-parent">',a+="<tbody>",b=getFileExt(String(e[c].furl)),b.length>5&&(b=""),a+="<tr><td>",a+=d=="0"?'<div class="picDiv" popupmenu="1" uhref="':'<div class="picDiv" popupmenu="0" uhref="',a+=e[c].furl,a+='">',a+=b=="jpg"||b=="jpeg"||b=="png"||b=="gif"||b=="bmp"?'<div id="fileviewicon" class="imgfileDiv bicon">':
b=="mp3"||b=="m4a"||b=="m4r"||b=="wav"?'<div id="fileviewicon" class="audiofileDiv bicon">':b=="mp4"||b=="rmvb"||b=="m4v"||b=="wmv"||b=="avi"||b=="mpg"||b=="mpeg"||b=="mkv"||b=="mov"||b=="flv"||b=="3gp"||b=="m2v"||b=="rm"?'<div id="fileviewicon" class="videofileDiv bicon">':b=="doc"||b=="docx"?'<div id="fileviewicon" class="docfileDiv bicon">':b=="ppt"||b=="pptx"?'<div id="fileviewicon" class="pptfileDiv bicon">':b=="xls"||b=="xlsx"?'<div id="fileviewicon" class="xlsfileDiv bicon">':b=="pdf"?'<div id="fileviewicon" class="pdffileDiv bicon">':
'<div id="fileviewicon" class="fileDiv bicon">',a+='<div class="selectDiv sicon"></div>',a+='<div class="selectHintDiv sicon"></div>',a+="</div></div>",a+="</td></tr>",a+="<tr><td>",a+='<div class="albuminfo" style="font-size:80%">',a+='<a id="list_item" qtype="1" isdir="0" uhref="',a+=e[c].furl,a+='" title="',a+=e[c].name,a+='" uid="',a+=e[c].uid,a+='" ext="',a+=b,a+='" freadonly="',a+=e[c].freadonly,a+='" fhidden="',a+=e[c].fhidden,a+='">',a+=e[c].shortname,a+="</a>",a+="</div>",a+="</td></tr>",
a+="<tr><td>",a+='<input type="button" class="btnDownload" value="'+m.getString("func_download")+'">',a+="</td></tr>",a+="</tbody>",a+="</table>",a+="</div>";$("div#fileview").append(a);$(".picDiv").mousedown(onMouseDownPicDIVHandler);$("input.btnDownload").click(function(){var a=$(this).parents(".thumb-table-parent").find("a#list_item"),b=a.attr("isdir"),a=a.attr("uhref");b==1?(b=$("div#modalWindow"),g_modal_url="/smb/css/download_folder.html?v="+a+"&p=slhp&a=agt&u="+g_storage.get(g_sharelink_openurl_key),
g_modal_window_width=600,g_modal_window_height=150,$("#jqmMsg").css("display","none"),$("#jqmTitleText").text(m.getString("title_download_folder")),b&&b.jqmShow()):window.open(a)});$("input.btnDownloadAll").click(function(){var a=$("div#modalWindow"),b=g_root_path,b=b.substr(0,b.lastIndexOf("/"));g_modal_url="/smb/css/download_folder.html?v="+g_root_path+"&p=slhp&a=agt&u="+b;g_modal_window_width=600;g_modal_window_height=150;$("#jqmMsg").css("display","none");$("#jqmTitleText").text(m.getString("title_download_folder"));
a&&a.jqmShow()})}}
function doPROPFIND(d,c,b,e){if(client!=null)try{client.PROPFIND(d,e,function(a,c,e){if(a)if(a==207){g_folder_array=[];g_file_array=[];if(window.DOMParser)a=new DOMParser,c=a.parseFromString(e,"text/xml");else if(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(e),!c.documentElement){alert("Fail to load xml!");showHideLoadStatus(!1);return}var l,n,f,j,a=c.documentElement.childNodes,e=c.documentElement.getAttribute("qtype");c.documentElement.getAttribute("readonly");c.documentElement.getAttribute("ruser");
c.documentElement.getAttribute("computername");c.documentElement.getAttribute("isusb");for(c=0;c<a.length;c++){var i="",r="",s="",o="",t="",u="",v="",w="",x="",y="",z="",A="",B="",h;j="";var C="0",p=a[c].childNodes;for(l=0;l<p.length;l++)if(p[l].nodeType==1&&p[l].nodeName=="D:propstat"){var D=p[l].childNodes;for(n=0;n<D.length;n++)if(D[n].nodeName=="D:prop"){var g=D[n].childNodes;for(f=0;f<g.length;f++)if(!(g[f].childNodes.length<=0))if(g[f].nodeName=="D:getcontenttype")r=String(g[f].childNodes[0].nodeValue);
else if(g[f].nodeName=="D:getuniqueid")s=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getonline")u=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getlastmodified")v=(new Date(String(g[f].childNodes[0].nodeValue))).toLocaleString();else if(g[f].nodeName=="D:getcontentlength")w=String(size_format(parseInt(g[f].childNodes[0].nodeValue)));else if(g[f].nodeName=="D:getmac")y=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getip")x=String(g[f].childNodes[0].nodeValue);
else if(g[f].nodeName=="D:gettype")z=String(g[f].childNodes[0].nodeValue);else if(g[f].nodeName=="D:getattr"){var q=g[f].childNodes;for(j=0;j<q.length;j++)if(q[j].nodeName=="D:readonly")A=q[j].childNodes[0].nodeValue;else if(q[j].nodeName=="D:hidden")B=q[j].childNodes[0].nodeValue}else g[f].nodeName=="D:getuseragent"?(j=String(g[f].childNodes[0].nodeValue),g_storage.set("user_agent",j)):g[f].nodeName=="D:getroutersync"&&(C=String(g[f].childNodes[0].nodeValue))}}else p[l].nodeType==1&&p[l].nodeName==
"D:href"&&(i=String(p[l].childNodes[0].nodeValue),n="",i.match(/^http/)&&(n=window.location.protocol+"//"+window.location.host),f=n+addPathSlash(d),i!=f?(i=i.replace(n,""),o=i.substring(i.lastIndexOf("/")+1,i.length),o!=""?(h=o,t=o=mydecodeURI(o)):i=""):i="");i!=""&&(r=="httpd/unix-directory"?g_folder_array.push({contenttype:r,furl:i,name:o,uname:h,shortname:t,online:u,time:v,size:w,ip:x,mac:y,uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}):g_file_array.push({contenttype:r,furl:i,name:o,uname:h,
shortname:t,online:u,time:v,size:w,ip:x,mac:y,uid:s,type:z,freadonly:A,fhidden:B,routersyncfolder:C}))}g_folder_array.sort(sortByName);g_file_array.sort(sortByName);h=addPathSlash(d);h!="/"&&(h=h.substring(0,h.length-1),h=h.substring(0,h.lastIndexOf("/")),h==""&&(h="/"));createThumbView(e,h,g_folder_array,g_file_array);g_storage.set(g_sharelink_openurl_key,d);$("div#fileview").scrollLeft(g_storage.get("contentscrollLeft"));$("div#fileview").scrollTop(g_storage.get("contentscrollTop"));closeJqmWindow(0);
b!=void 0&&b()}else a==501?doPROPFIND(d,!1):alert(m.getString(a))},null,1)}catch(a){alert("catch error: "+a)}}
$(document).ready(function(){document.oncontextmenu=function(){return!1};$(document).keydown(function(c){c.keyCode==27?$("#image_slide_show").close(g_image_player_setting):c.keyCode==37?$("#image_slide_show").prev(g_image_player_setting):c.keyCode==39&&$("#image_slide_show").next(g_image_player_setting)});var d=String(window.navigator.userLanguage||window.navigator.language).toLowerCase(),d=g_storage.get("lan")==void 0?d:g_storage.get("lan");m.setLanguage(d);g_storage.set("slhp",$("div#fileview").attr("port"));
g_storage.set("agt","");g_sharelink_openurl_key=g_root_path=$("div#fileview").attr("rootpath");d=g_storage.get(g_sharelink_openurl_key);d==void 0&&(d=g_root_path);doPROPFIND(d,!1,null,0);d="";d+="<div id='modalWindow' class='jqmWindow'>";d+="<div id='jqmTitle'>";d+="<span id='jqmTitleText'></span>";d+="</div>";d+="<div id='jqmMsg'>";d+="<span id='jqmMsgText'></span>";d+="</div>";d+="<div id='jqmContent' style='padding;0px;margin:0px'>";d+="</div>";d+="</div>";$(d).appendTo($("body"));$("input.btnDownloadAll").attr("value",
m.getString("func_downloadall"));$("#modalWindow").jqm({overlay:70,modal:!0,target:"#jqmContent",onHide:function(c){$(c.w).fadeOut("2000",function(){c.o.remove();g_show_modal=0})},onShow:function(c){var c=$(c.w),b=$("#jqmContent",c);$("#jqmTitle",c);var d=(getPageSize()[0]-g_modal_window_width)/2;g_show_modal=1;navigator.userAgent.toLowerCase();var a=function(){var a=-1;navigator.appName=="Microsoft Internet Explorer"&&/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)!=null&&(a=parseFloat(RegExp.$1));
return a};g_modal_url!=""&&(b.empty(),$("<iframe src='' frameborder='0' width='100%' height='100%'>").appendTo(b),$("iframe",c).attr("src",g_modal_url));isBrowser("msie")&&a()<=8&&(g_modal_window_height+=25);c.css({width:g_modal_window_width,height:g_modal_window_height,left:d,top:-g_modal_window_height,opacity:0,display:"block"}).jqmShow().animate({width:g_modal_window_width,height:g_modal_window_height,top:0,left:d,marginLeft:0,opacity:1},200,function(){})}})});
