#!/bin/sh
D="/var/spool/cron/crontabs"
U="$D/cron.update"
F="$D/`nvram get http_username`"
N="$F.new"
L="/var/lock/cron.lock"

if [ $# -gt 1 -a "$1" = "a" -o "$1" = "d" ]; then
	{
		flock -x 278
		ID=$2
		grep -v "#$ID#\$" $F >$N 2>/dev/null
		if [ "$1" = "a" ]; then
			shift
			shift
			echo "$* #$ID#" >>$N
		fi
		mv $N $F
		echo `nvram get http_username` >>$U
	} 278>$L

	exit 0
fi

if [ "$1" = "l" ]; then
	cat $F 2>/dev/null
	exit 0
fi

cat <<END

Cron Utility
add:    cru a <unique id> <"min hour day month week command">
delete: cru d <unique id>
list:   cru l

END
exit 0
