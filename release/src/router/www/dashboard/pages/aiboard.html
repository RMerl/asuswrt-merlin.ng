<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,  user-scalable=no"/>
    <style>
        /* ========================================
         * CSS VARIABLES & THEMING
         * ======================================== */
        :root {
            /* Art & Layout Variables */
            --bleed-y: 90px;

            /* Color System */
            --color-start: rgba(0, 153, 255, 0.2);
            --color-end: rgba(0, 247, 255, 0.25);
            --color-stroke-start: #7230ff;
            --color-stroke-end: #1cfff4;

            /* UI Components */
            --slider-fill-start: #6366f1;
            --slider-fill-end: #df63f1;
            --slider-track: #e5e7eb;
            --slider-thumb: #dc2626;
            --progress: 50%;

            /* Layout & Spacing */
            --bandwidth-row-bg: rgba(255, 255, 255, 0.4);
            --bandwidth-row-border: var(--neutral-30, #fff);
            --bandwidth-cell-divider: var(--cell-stroke);
            --bandwidth-divider-gap: 16px;
            --toggle-radius: 14px;
            --toggle-thumb-radius: 50%;
            --radius-none: 0;

            /* Settings Panel */
            --setting-row-bg: var(--bandwidth-row-bg, #fff);
            --table-row-text-color: var(--body-text-color);
            --setting-row-border: var(--bandwidth-row-border);
            --cell-divider-border: var(--bandwidth-row-border);

            /* Dividers */
            --divide-stroke-color-default: var(--neutral-30);
            --divider-strong: var(--white-alpha-100);
            --divider-weak: var(--black-alpha-3);
            --divider-default: var(--neutral-30);
        }

        /* Dark Mode Theme */
        [data-asuswrt-color="dark"] {
            --setting-row-bg: rgba(24, 24, 24, 0.4);
            --bandwidth-row-bg: rgba(24, 24, 24, 0.4);
            --table-row-text-color: var(--white-alpha-100);
            --bandwidth-row-border: var(--neutral-90, #333);
            --setting-row-border: var(--bandwidth-row-border);
            --cell-divider-border: var(--bandwidth-row-border);
            --divide-stroke-color-default: var(--white-alpha-10);
            --divider-strong: var(--white-alpha-10);
            --divider-weak: var(--white-alpha-5);
            --divider-default: var(--neutral-90);
        }

        /* ========================================
         * BASE ELEMENTS
         * ======================================== */
        label {
            font-weight: bold;
        }

        h2, h3, h4, h5, h6 {
            color: var(--text-subtitle-color);
        }

        /* ========================================
         * SETTINGS COMPONENTS
         * ======================================== */
        .setting-row {
            display: flex;
            align-items: center;
            padding: 1em 0;
            gap: 2em;
            border-bottom: 1px solid var(--divide-stroke-color-El20);
        }

        .setting-row:last-child {
            border-bottom: none;
        }

        .setting-label {
            flex: 0 0 35%;
            min-width: 120px;
            padding-left: 10px;
            font-size: 14px;
            font-weight: 500;
        }

        .setting-side {
            display: flex;
            align-items: center;
            gap: 1em;
        }

        .setting-side-col {
            display: block;
            flex-direction: column;
            align-items: left;
        }

        .setting-info {
            padding: 0.375rem 0;
            font-size: .825rem;
            font-weight: 400;
            line-height: 1.5;
        }

        /* ========================================
         * CONTENT LAYOUT
         * ======================================== */

        .safe-item .safe-item-background-image {
            z-index: -1;
        }

        .safe-item .safe-item-background-image img {
            width: 100px;
            height: auto;
        }

        /* ========================================
         * APP COMPONENTS
         * ======================================== */
        .app-card {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-around;
            gap: 16px;
            padding: 8px;
            width: 100%;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 3;
        }

        .app-card .app-info {
            display: flex;
            flex-direction: column;
        }


        .card-inner-content {
            z-index: 2;
            height: 100%;
            padding: 16px 24px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: .5rem;
        }

        .card-title-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #35F2FF;
            text-shadow: 0 0 15px rgba(53, 242, 255, 0.4);
            margin-bottom: 8px;
        }

        .safe-item {
            flex: 1 0 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-radius: 4px;
            border: 1px solid #FFF;
            background: rgba(255, 255, 255, 0.40);
            box-shadow: 0 0 14px 0 rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(17px);
        }

        .safe-item .safe-description {
            font-style: italic;
            color: var(--text-subtitle-color);
            width: 100%;
            margin-top: .5rem;
            margin-bottom: 0;
            font-size: 0.875rem;
        }

        .safe-item .safe-button {
            position: absolute;
            right: 1rem;
            bottom: 1rem;
        }

        .card-description {
            margin-top: .5rem;
            margin-bottom: 0;
            font-size: 0.875rem;
        }

        .card-footer {
            height: 56px;
        }

        .block-title {
            font-size: 1.25rem;
            font-style: italic;
            font-weight: 600;
            letter-spacing: 0.4px;
            margin-top: .5rem;
            margin-bottom: .5rem;
        }

        .safe-title, .app-title {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 1.25rem;
            font-style: italic;
            font-weight: 600;
            letter-spacing: 0.4px;
            margin-top: .3rem;
        }

        .safe-content, .app-content {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 200px;
        }

        .safe-label {
            color: var(--primary-50, #FF1929);
            font-size: 12px;
            font-style: italic;
            font-weight: 400;
            line-height: 16px;
            letter-spacing: 0.4px;
        }

        .ai-tips {
            display: flex;
            gap: 8px;
            padding: 1rem;
            overflow-x: auto;
            cursor: grab;
            user-select: none;
        }

        .ai-tips::-webkit-scrollbar {
            display: none;
        }

        .ai-tip {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            backdrop-filter: blur(17px);
            border: 1px solid #FFF;
            background: rgba(255, 255, 255, 0.20);
            padding: 10px 16px;
            background: #f8f9fa;
            border-radius: 50px;
            font-size: 0.875rem;
            color: #006EFF;
            cursor: pointer;
            width: fit-content;
            flex-shrink: 0;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .ai-tip:hover::before {
            opacity: 1;
        }

        .ai-tip .icon-container {
            display: none;
        }

        .ai-tip:hover {
            background: rgb(255, 255, 255, .25);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .ai-tip:hover .icon-container {
            display: flex;
            width: 80px;
            border-radius: 16px;
            justify-content: flex-start;
            padding: 8px 16px;
            background-color: #0091ff;
            align-items: center;
        }

        .more-action .dropdown-toggle::after {
            display: none;
        }

        .docker-container-div {
            height: 400px;
        }

        .ai-example-input {
            position: relative;
            pointer-events: none;
        }

        .ai-example-input .icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            pointer-events: none;
        }

        .ai-example-input input {
            padding-left: 40px;
        }

        .ai-example-result {
            margin-top: -8px;
            display: flex;
            padding: 16px;
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
            border-top: 3px solid var(--primary-50, #FF1929);
            background: var(--white-alpha-100, #FFF);
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.10);
        }

        .ai-faq-btn {
            cursor: pointer;
        }

        .ai-assistant-body {
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }

        #first-block-cn {
            min-height: 300px;
        }

        #first-block-cn .card {
            background: url("/images/aiboard/img-bg-ai-assistant.png");
            background-size: auto 100%;
            background-repeat: no-repeat;
            background-position: 30% center;
        }

        #first-block-cn .ai-tips {
            flex-direction: column;
        }

        /* ========================================
         * RESPONSIVE DESIGN
         * ======================================== */


        @media (max-width: 1200px) {
            .safe-item .safe-description {
                width: 100%;
            }
        }

        @media (max-width: 992px) {
            .app-card {
                box-shadow: none;
                background: transparent;
                backdrop-filter: none;
                border: none;
            }

            .app-card .app-info {
                display: none;
            }

            .safe-item .safe-description {
                width: 100%;
            }

            .ai-tips {
                flex-direction: row;
            }

        }

        @media (max-width: 768px) {
            .setting-row {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5em;
                padding: 1em 0;
            }

            .setting-label,
            .setting-side {
                min-width: 0;
                text-align: left;
            }

            .setting-label {
                flex: 0 0 0;
            }
        }

        @media (max-width: 576px) {
            .card-inner-content {
                flex-direction: column;
                gap: 1rem;
            }

            .safe-content, .app-content {
                height: auto;
            }

            .safe-item-background-image, .brand-icon {
                position: absolute;
                right: .5rem;
                top: .5rem;
            }

            .brand-icon object {
                height: 30px !important;
            }

            .docker-container-div {
                height: auto;
            }
        }

        #AIrestore_FAQ {
            cursor: pointer;
            text-decoration: underline;
            font-style: normal;
        }
    </style>
</head>

<body>
<div class="d-flex align-items-center mb-3">
    <div class="page-title">AI Board<i data-faq="AI_FAQ_AIBoard" role="icon"
                                       class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i></div>
</div>
<div class="row d-none" id="first-block-cn">
    <div class="col-12 mb-3">
        <div class="card card-bar-2 h-100">
            <div class="card-body ai-assistant-body">
                <div class="row">
                    <div class="col-12 col-lg-4">
                        <div class="ai-assistant-first-section">
                            <div class="safe-title mb-3">
                                <#Setting_ai_router_assist#>
                            </div>
                            <div class="d-flex flex-column gap-2">
                                <div class="card-description">
									<#Setting_ai_router_assist_desc#>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div id="ai-tips" class="ai-tips ai-assistant-second-section">
                        </div>
                    </div>
                    <div class="col-12 col-lg-4">
                        <div class="d-flex flex-column gap-2">
                            <div class="ai-example-input">
                                <i role="icon" class="icon icon-AiBoard icon-size-20"></i>
                                <input class="form-control">
                            </div>
                            <div class="ai-example-result" style="display: none;">
                                <div class="text-break mb-2 p-2"
                                     style="background-color: #f8f9fa; color: #6c757d; font-size: 0.9em; border-left: 5px solid #dee2e6;">
                                    <strong id="ai-example-question"></strong>
                                </div>
                                <div class="text-break mb-3" id="ai-example-answer"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-center border-0">
                <div class="setting-side">
                    <button class="btn btn-outline-primary app-install-btn disabled"
                            data-app="slm-cn-asus">
                        Upgrade
                    </button>
                    <div class="d-flex align-items-center gap-1 message d-none" data-app="slm-cn-asus">
                        <span class="setting-info"></span>
                        <img src="images/InternetScan.gif"/>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row d-none" id="first-block">
    <div class="col-12 col-xl-5 mb-3">
        <div class="card card-bar-2 h-100">
            <div class="card-body ai-assistant-body">
                <div class="ai-assistant-first-section">
                    <div class="safe-title mb-3">
                        <#Setting_ai_router_assist#>
                    </div>
                    <div class="d-flex flex-column gap-2">
                        <div class="card-description">
							<#Setting_ai_router_assist_desc#>
                        </div>
                    </div>
                </div>
                <div id="ai-tips" class="ai-tips ai-assistant-second-section">
                </div>
                <div class="d-flex flex-column gap-2">
                    <div class="ai-example-input">
                        <i role="icon" class="icon icon-AiBoard icon-size-20"></i>
                        <input class="form-control">
                    </div>
                    <div class="ai-example-result" style="display: none;">
                        <div class="text-break mb-2 p-2"
                             style="background-color: #f8f9fa; color: #6c757d; font-size: 0.9em; border-left: 5px solid #dee2e6;">
                            <strong id="ai-example-question"></strong>
                        </div>
                        <div class="text-break mb-3" id="ai-example-answer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-xl-7 mb-3">
        <div class="card card-bar-2 h-100">
            <div class="card-body p-4">
                <div class="safe-title">Advertisement Blocking</div>
                <div class="d-flex flex-column">
                    <div class="card-description">Triple level content filter</div>
                    <div class="card-inner-content">

                        <div class="safe-item">
                            <div class="card-body">
                                <div class="safe-label">Edge AI</div>
                                <div class="safe-title">AiProtection</div>
                                <div class="safe-content">
                                    <p class="safe-description">
                                        Blocks ads and trackers with one click.
                                    </p>
                                    <div class="safe-item-background-image"><img
                                            src="../images/aiboard/aiboard-aiprotection.png"
                                            style="width: 100px;height: 90px;">
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between">
                                <div id="ark_adblock_switch" class="toggle-button with-text">
                                    <div class="toggle-button-handle"></div>
                                </div>
                            </div>
                        </div>
                        <div class="safe-item">
                            <div class="card-body">
                                <div class="safe-label">Edge server</div>
                                <h3 class="safe-title">AdGuard Home<i data-faq="AI_FAQ_AdguardHome" role="icon"
                                                                    class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i>
                                </h3>
                                <div class="safe-content">
                                    <p class="safe-description">
                                        A self-hosted edge server on router. Provides detailed network insights,
                                        advanced control, and enhanced home privacy.
                                    </p>
                                    <div class="safe-item-background-image"><img
                                            src="../images/aiboard/aiboard-adguard-home.svg">
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between">
                                <div class="setting-side">
                                    <button class="btn btn-outline-primary app-install-btn d-none disabled"
                                            data-app="adguard">
                                        <#Excute#>
                                    </button>
                                    <div class="d-flex align-items-center gap-1 message" data-app="adguard">
                                        <span class="setting-info"></span>
                                        <img src="images/InternetScan.gif"/>
                                    </div>
                                </div>
                                <button class="btn btn-outline-primary app-open-btn disabled" data-app="adguard"><#CTL_open#></button>
                            </div>
                        </div>
                        <div class="safe-item">
                            <div class="card-body">
                                <div class="safe-label">Cloud server</div>
                                <h3 class="safe-title">AdGuard DNS<i data-faq="AI_FAQ_AdguardDNS" role="icon"
                                                                   class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i>
                                </h3>
                                <div class="safe-content">
                                    <p class="safe-description">
                                        Extends protection across multiple sites via the cloud.
                                    </p>
                                    <div class="safe-item-background-image"><img
                                            src="../images/aiboard/aiboard-adguard.svg">
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-end">
                                <button class="btn btn-outline-primary" onclick="pageRedirect('parentalcontrol', 'adGuard_DNS')"><#CTL_open#></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12 col-md-4 h-100 mb-3">

        <div class="block-title"><#Setting_ai_dk_Management#></div>

        <!-- Portainer -->
        <div id="card_portainer" class="card card-bar pt-2" style="height:400px;">
            <div class="card-body p-4">
                <div class="app-title"><#Setting_ai_dk_Ctrl_Deploy#> <i data-faq="AI_FAQ_portainer" role="icon"
                                                           class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i>
                </div>
                <div class="app-content">
                    <p class="card-description"><#Setting_ai_desc_Ctrl_Deploy#></p>
                    <div class="brand-icon">
                        <div class="d-flex gap-1 align-items-center">
                            <object type="image/svg+xml" data="../images/aiboard/logo-docker.svg" role="img"
                                    style="width:auto; height:48px; vertical-align:middle;"></object>
                            &
                            <object type="image/svg+xml" data="../images/aiboard/logo-portainer.svg" role="img"
                                    style="width:auto; height:48px; vertical-align:middle;"></object>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-footer d-flex align-items-center justify-content-between">
                <div class="setting-side">
                    <div id="enable_portainer_btn" class="toggle-button with-text">
                        <div class="toggle-button-handle"></div>
                    </div>
                    <button class="btn btn-outline-primary app-install-btn d-none disabled" data-app="portainer">
                        <#Excute#>
                    </button>
                    <div class="d-flex align-items-center gap-1 message" data-app="portainer">
                        <span class="setting-info"></span>
                        <img src="images/InternetScan.gif"/>
                    </div>
                </div>
                <div class="d-flex">
                    <button class="btn btn-outline-primary app-open-btn disabled" data-app="portainer"><#CTL_open#></button>
                    <div class="more-action btn-group dropup d-none">
                        <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown"
                                aria-expanded="false">
                            <i role="icon" class="d-block icon-size-18 icon-more-horiz"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a id="reset_portainer_btn" class="dropdown-item" href="#"><#CTL_restore#></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-md-8 h-100 mb-3">
        <div class="block-title"><#Setting_ai_dk_Apps#></div>
        <div class="card card-bar p-2 d-flex justify-content-center docker-container-div">
            <div class="row gap-2 gap-sm-0">
                <!-- HA -->
                <div class="col-12 col-sm-6">
                    <div class="safe-item">
                        <div class="card-body">
                            <div class="app-title"><#Setting_ai_dk_HA#> <i data-faq="AI_FAQ_HA" role="icon"
                                                                     class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i>
                            </div>
                            <div class="app-content">
                                <p class="card-description">
                                    <#Setting_ai_desc_HA#>
                                </p>
                                <div class="brand-icon">
                                    <object type="image/svg+xml" data="../images/aiboard/logo-home-assistant.svg"
                                            role="img"
                                            style="width:auto; height:48px; vertical-align:middle;"></object>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <div class="setting-side">
                                <button class="btn btn-outline-primary app-install-btn d-none disabled"
                                        data-app="homeassistant">
                                    <#Excute#>
                                </button>
                                <div class="d-flex align-items-center gap-1 message" data-app="homeassistant">
                                    <span class="setting-info"></span>
                                    <img src="images/InternetScan.gif"/>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary app-open-btn disabled" data-app="homeassistant"><#CTL_open#></button>
                        </div>
                    </div>
                </div>
                <!-- FRIGATE -->
                <div class="col-12 col-sm-6">
                    <div class="safe-item">
                        <div class="card-body">
                            <div class="app-title">FRIGATE <i data-faq="AI_FAQ_Frigate" role="icon"
                                                              class="icon icon-help-hexagon icon-size-18 ai-faq-btn"></i>
                            </div>
                            <div class="app-content">
                                <p class="card-description">
                                    <#Setting_ai_desc_frigate#>
                                    <#Setting_ai_note_frigate#>
                                    <span>
                                    <br><#Setting_ai_faq_frigate#>
                                    </span>
                                </p>
                                <div class="brand-icon">
                                    <object type="image/svg+xml" data="../images/aiboard/logo-frigate.svg"
                                            role="img"
                                            style="width:auto; height:48px; vertical-align:middle;"></object>
                                </div>
                            </div>
                        </div>

                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <div class="setting-side">
                                <button class="btn btn-outline-primary app-install-btn d-none disabled"
                                        data-app="frigate"><#Excute#>
                                </button>
                                <div class="d-flex align-items-center gap-1 message" data-app="frigate">
                                    <span class="setting-info"></span>
                                    <img src="images/InternetScan.gif"/>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary app-open-btn disabled" data-app="frigate"><#CTL_open#></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-12 mb-3">
        <div class="row">
            <div class="col-12">
                <div class="block-title"><#Setting_ai_board#></div>
                <div class="card card-bar">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-12 col-lg-8">
                                <div class="border pt-2 mb-3">
                                    <h5 class="card-header d-flex align-items-center justify-content-between">
                                        <!-- Change the AI Board login password, host name, and IP address settings.-->
                                        <#diskUtility_information#>
                                    </h5>
                                    <div class="card-body">
                                        <!-- Hostname -->
                                        <section class="mb-3">
                                            <div class="setting-row">
                                                <label class="setting-label"
                                                       for="ai_hostname"><#LANHostConfig_x_DDNSHostNames_itemname#></label>
                                                <div class="setting-side">
                                                    <input id="ai_hostname" class="input form-control" disabled
                                                           type="text"
                                                           value=""
                                                           maxlength="32"
                                                           onKeyPress="return validator.isString(this, event);"
                                                           style="width:100%;max-width:320px;"
                                                           autocorrect="off" autocapitalize="off">
                                                    <div id="ai_hostname_postfix" class="setting-info">.local</div>
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                    <div class="card-footer text-end d-none">
                                        <button type="button" id="applyBtn" class="btn btn-primary"><#CTL_apply#>
                                        </button>
                                    </div>
                                </div>

                                <section class="border pt-2">
                                    <h5 class="card-header d-flex align-items-center justify-content-between">
                                        <#menu5_6_3#>
                                    </h5>
                                    <div class="card-body">
                                        <div class="setting-row">
                                            <label class="setting-label" for="currentFwVer"><#Setting_ai_board_fw_ver#></label>
                                            <div class="setting-side">
                                                <div id="currentFwVer" class="setting-info"></div>
                                            </div>
                                        </div>
                                        <div class="setting-row">
                                            <label class="setting-label"
                                                   for="checkBtn"><#AiMesh_Check_Update#></label>
                                            <div class="setting-side">
                                                <button id="checkBtn" class="btn btn-outline-primary btn-main">
                                                    <#AiMesh_Check_Update#>
                                                </button>
                                                <button id="upgradeBtn" class="btn btn-outline-primary btn-main"
                                                        style="display:none;">
                                                    <#CTL_upgrade#>
                                                </button>
                                                <div id="check_states">
                                                    <span id="update_states"></span>
                                                    <img id="update_scan" style="display:none;"
                                                         src="images/InternetScan.gif"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                            <div id="card_rescuesetting" class="col-12 col-lg-4 mt-3 mt-lg-0">
                                <section class="border pt-2 mb-3 h-100">
                                    <h5 class="card-header"><#BTN_REBOOT#></h5>
                                    <div class="card-body">
                                        <div class="row px-2">
                                            <div id="tab-section-aiboard"
                                                 class="qoe-container container tab-content">
                                                <div class="row justify-content-center">
                                                    <div class="col-12">
                                                        <!-- Restore setting -->
                                                        <section class="mb-3">
                                                            <div class="setting-row setting-rescue d-none">
                                                                <label class="setting-label" for="rescueBtn"><#Setting_factorydefault_itemname#></label>
                                                                <div class="setting-side setting-side-col">
                                                                    <button id="rescueBtn"
                                                                            class="btn btn-outline-primary btn-main"
                                                                            style="display:block;">
                                                                        <#CTL_restore#>
                                                                    </button>
                                                                    <span style="color:rgb(0, 108, 225);font-size:14px; display:block;margin-top:8px;"><#Setting_ai_rescue_note#></span>
                                                                </div>
                                                            </div>
                                                            <div class="setting-row" style="margin-top:40px;">
                                                                <label class="setting-label"
                                                                       for="rebootBtn"><#BTN_REBOOT#></label>
                                                                <div class="setting-side">
                                                                    <button id="rebootBtn"
                                                                            class="btn btn-outline-primary btn-main">
                                                                        <#BTN_REBOOT#>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </section>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/validator.js"></script>
<script type="module">
    let get_slm_status = null;
    try {
        const slmModule = await import('/js/indexing.js');
        get_slm_status = slmModule.get_slm_status;
    } catch (error) {
        console.warn('Failed to import SLM status module:', error);
    }

    const urlParameters = new URLSearchParams(window.location.search);
    const aiboard_action = urlParameters.get("aiboard_action");

    const lang = system.language.currentLang;
    const is_BE96_AI = (httpApi.nvramGet(["productid"]).productid == "GT-BE96_AI");
    const faqBtns = document.querySelectorAll('i.ai-faq-btn');
    faqBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const faqKey = btn.getAttribute('data-faq');
            if (faqKey) {
                if (is_BE96_AI && faqKey == "AI_FAQ_AIBoard") {
                    openFaq("AI_FAQ_BE96AI_HA");
                } else if (is_BE96_AI && faqKey == "AI_FAQ_portainer") {
                    openFaq("AI_FAQ_DICP");
                } else
                    openFaq(faqKey);
            }
        });
    })
    const faqLinks = document.querySelectorAll('a.ai-faq-btn');
    faqLinks.forEach(btn => {
        btn.addEventListener('click', () => {
            const faqKey = btn.getAttribute('data-faq');
            if (faqKey) {
                openFaq(faqKey);
            }
        });
    })
    const openFaq = (faqKey) => {
        const faqUrl = `https://nw-dlcdnet.asus.com/support/forward.html?model=&type=${faqKey}&lang=${lang}&kw=&num=`;
        window.open(faqUrl, '_blank');
    };


    class AppContainer {
        constructor(prop) {
            const {
                name,
                displayName,
                appName,
                status = 'not_installed',
                installed = false,
                openBtn,
                installBtn,
                enableBtn = null,
                messageDiv = null
            } = prop;
            this.name = name;
            this.displayName = displayName;
            this.appName = appName;
            this.status = status;//not_installed, installing, running, stopped
            this.installed = installed; // 0: not installed, 1: installed
            this.openBtn = openBtn;
            this.installBtn = installBtn;
            this.enableBtn = enableBtn;
            this.messageDiv = messageDiv;
        }

        open() {
            const ai_hostname_str = httpApi.nvramGet(["ai_hostname"]).ai_hostname;
            const urlMap = {
                'formal-portainer-asus': `https://${ai_hostname_str}.local:9443`,
                'homeassistant-asus': `http://${ai_hostname_str}.local:8123`,
                'adguard-asus': `http://${ai_hostname_str}.local:3000`,
                'formal-frigate-asus': `https://${ai_hostname_str}.local:8971`
            };
            const url = urlMap[this.name];
            if (url) {
                if (url == `http://${ai_hostname_str}.local:3000`) {
                    var get_adguard_home_port = httpApi.hookGet("ai_adguard_home_port", true);	// 3000:80
                    window.open((get_adguard_home_port == 3000) ? url : url.replace("3000", get_adguard_home_port), '_blank');
                } else {
                    window.open(url, '_blank');
                }
            } else {
                console.error(`No URL mapped for ${this.name}`);
            }
        }

        applyInstall() {
            const self = this;
            self.installBtn?.classList.add('d-none');
            self.messageDiv?.classList.remove('d-none');
            const messageSpan = self.messageDiv?.querySelector('span');
            messageSpan.innerHTML = `<#Excute_processing#>`;

            let postObject = {};
            switch (this.appName) {
                case "portainer":
                    postObject.ai_app_name = "start_portainer";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                    break;

                case "homeassistant":
                    postObject.ai_app_name = "start_homeassistant";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                    break;

                case "adguard":
                    const _nvram = httpApi.nvramGet([
                        "wan0_dnsenable_x",
                        "wan0_dns",
                        "ai_sys_ip_address"
                    ], true);
                    const {wan0_dnsenable_x, wan0_dns, ai_sys_ip_address} = _nvram;
                    postObject.ai_app_name = "start_adguard";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "restart_wan_dns 0;start_ai_request app";
                    postObject.wan0_dnsenable_x = "0";
                    postObject.wan0_dns1_x = ai_sys_ip_address;
                    if (wan0_dns.split(" ")[0] != ai_sys_ip_address) {
                        postObject.wan0_dns2_x = (typeof wan0_dns === "string" && wan0_dns.trim() !== "") ? wan0_dns.split(" ")[0] : "";
                    }
                    break;

                case "frigate":
                    postObject.ai_app_name = "start_frigate";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                    break;

                case "slm-cn-asus":
                    postObject.ai_app_name = "start_slm";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                    break;

                default:
                    console.warn("Unknown item.", this.name);
                    break;
            }
            httpApi.nvramSet(postObject);

            setTimeout(function () {
                self.detect_install("install");
            }, 8000);
        }

        install() {
            // PolicyStatus()
            //     .then(data => {
            //         httpApi.log('aiboard_eula_status', JSON.stringify(data));
            //         if (data.AIBOARD_EULA < 1 || data.AIBOARD_EULA_read == 0) {
            //             const policyModal = new PolicyModalComponent({
            //                 policy: "AIBOARD_EULA",
            //                 modalSize: "modal-lg",
            //                 agreeBtnText: "<#Acknowledge#>",
            //                 disagreeBtnText: "<#CTL_Decline#>",
            //                 agreeCallback: () => {
            //                     if (this.installed) {
            //                         console.warn(`${this.appName} is already installed.`);
            //                         return;
            //                     }
            //                     console.log(`Installing ${this.displayName}...`);
            //                     this.applyInstall();
            //                     this.status = 'installing';
            //                     document.querySelectorAll('.app-install-btn').forEach(btn => {
            //                         btn.classList.add('disabled');
            //                     })
            //                 }
            //             });
            //
            //             policyModal.show();
            //         } else {
            //             console.log(`Installing ${this.displayName}...`);
            //             this.applyInstall();
            //             this.status = 'installing';
            //             document.querySelectorAll('.app-install-btn').forEach(btn => {
            //                 btn.classList.add('disabled');
            //             })
            //         }
            //     });
            console.log(`Installing ${this.displayName}...`);
            this.applyInstall();
            this.status = 'installing';
            document.querySelectorAll('.app-install-btn').forEach(btn => {
                btn.classList.add('disabled');
            })
        }

        toggleEnable() {
            if (!this.enableBtn) return;

            // Special handling for Portainer
            if (this.name === 'formal-portainer-asus') {
                let postObject = {};
                let hasActive = this.enableBtn.classList.contains("active");
                if (hasActive) {
                    this.enableBtn.classList.remove("active");
                    postObject.ai_app_name = "stop_portainer";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                } else {
                    this.enableBtn.classList.add("active");
                    postObject.ai_app_name = "start_portainer";
                    postObject.action_mode = "apply";
                    postObject.rc_service = "start_ai_request app";
                }

                let applyTime = (postObject.ai_app_name == "stop_portainer") ? 30 : 40;
                httpApi.nvramSet(postObject, function () {
                    showLoading(applyTime);

                    setTimeout(function () {
                        let queryPost = {};
                        queryPost.action_mode = "apply";
                        queryPost.rc_service = "start_ai_request query";
                        httpApi.nvramSet(queryPost);
                    }, (applyTime - 5) * 1000);

                    setTimeout(function () {
                        location.reload();
                    }, applyTime * 1000);
                });
                return;
            }

            // Default toggle behavior
            const isEnabled = this.enableBtn.classList.contains('active');
            if (isEnabled) {
                this.enableBtn.classList.remove('active');
                this.status = 'stopped';
            } else {
                this.enableBtn.classList.add('active');
                this.status = 'running';
            }
        }

        updateStatus() {
            if (this.appName === 'slm-cn-asus') {
                // The SLM app uses a different installation mechanism
                if (this.status === 'running') {
                    this.installBtn.classList.add('d-none');
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                } else if (this.status === 'not_installed') {
                    this.installBtn.classList.remove('d-none');
                    this.installBtn.classList.remove('disabled');
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                } else if (this.status === 'installing') {
                    this.installBtn.classList.add('d-none');
                    if (this.messageDiv) {
                        this.messageDiv.classList.remove('d-none');
                    }
                } else if (this.status === 'stopped') {
                    this.installBtn.classList.remove('d-none');
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                }
            } else {
                if (this.status === 'running') {
                    this.openBtn.classList.remove('disabled');
                    this.openBtn?.classList.remove('d-none');
                    this.installBtn.classList.add('disabled');
                    this.installBtn.classList.add('d-none');
                    if (this.enableBtn) {
                        this.enableBtn.classList.add('active');
                    }
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                } else if (this.status === 'not_installed') {
                    this.openBtn?.classList.add('disabled');
                    this.openBtn?.classList.add('d-none');
                    this.installBtn?.classList.remove('disabled');
                    this.installBtn?.classList.remove('d-none');
                    if (this.enableBtn) {
                        this.enableBtn.classList.add('d-none');
                    }
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                } else if (this.status === 'installing') {
                    this.openBtn.classList.add('disabled');
                    this.installBtn.classList.add('d-none');
                    if (this.enableBtn) {
                        this.enableBtn.classList.add('d-none');
                    }
                    if (this.messageDiv) {
                        this.messageDiv.classList.remove('d-none');
                    }
                } else if (this.status === 'stopped') {
                    if (this.appName === 'portainer') {
                        this.installBtn.classList.add('disabled');
                        this.installBtn.classList.add('d-none');
                    } else {
                        this.installBtn.classList.remove('disabled');
                        this.installBtn.classList.remove('d-none');
                    }
                    this.openBtn.classList.add('disabled');
                    if (this.enableBtn) {
                        this.enableBtn.classList.remove('active');
                    }
                    if (this.messageDiv) {
                        this.messageDiv.classList.add('d-none');
                    }
                } else {
                    console.warn(`Unknown status: ${this.status}`);
                }
            }

            if (this.appName === "slm-asus" || this.appName === "slm-cn-asus") {
                if (typeof get_slm_status === 'function') {
                    get_slm_status(true);
                }
            }
        }

        init() {
            this.updateStatus();

            if (this.installBtn) {
                this.installBtn.addEventListener('click', () => {
                    if (this.status === 'not_installed') {
                        this.install();
                    } else {
                        console.warn(`${this.displayName} is already installed.`);
                    }
                });
            }

            if (this.openBtn) {
                this.openBtn.addEventListener('click', () => {
                    if (this.status === 'running') {
                        this.open();
                    } else {
                        console.warn(`${this.displayName} is not running.`);
                    }
                });
            }

            if (this.enableBtn) {
                this.enableBtn.addEventListener('click', () => {
                    this.toggleEnable();
                });
            }
        }

        detect_install(flag) {
            const self = this;

            try {
                const _nvram = httpApi.nvramGet(["ai_app_prog_status", "ai_app_prog_error_code", "ai_app_prog_reason", "ai_app_prog_total_steps", "ai_app_prog_current_step", "ai_app_prog_current_percent", "ai_app_prog_current_image", "ai_app_name"], true);
                const app_prog_status = _nvram.ai_app_prog_status || "";
                const app_prog_error_code = _nvram.ai_app_prog_error_code || "0";
                const app_prog_reason = _nvram.ai_app_prog_reason || "";
                const app_prog_total_steps = parseInt(_nvram.ai_app_prog_total_steps) || 0;
                const app_prog_current_step = parseInt(_nvram.ai_app_prog_current_step) || 0;
                const app_prog_current_percent = parseInt(_nvram.ai_app_prog_current_percent) || 0;
                const app_prog_current_image = _nvram.ai_app_prog_current_image || "";
                const ai_app_name = _nvram.ai_app_name || "";

                httpApi.log("check_update", `ai_app_prog_status: ${app_prog_status}, ai_app_prog_error_code: ${app_prog_error_code}, ai_app_prog_reason: ${app_prog_reason}, ai_app_prog_total_steps: ${app_prog_total_steps}, ai_app_prog_current_step: ${app_prog_current_step}, ai_app_prog_current_percent: ${app_prog_current_percent}, ai_app_prog_current_image: ${app_prog_current_image}, ai_app_name: ${ai_app_name}`);
                let install_hint = `${app_prog_status} (${app_prog_current_step}/${app_prog_total_steps})`;

                if (app_prog_status !== "DONE" && app_prog_status !== "failed" && app_prog_status !== "") {
                    if (`start_${this.appName}`.includes(ai_app_name)) {
                        document.querySelectorAll('.app-install-btn').forEach(btn => {
                            btn.classList.add('disabled');
                        })
                        document.querySelectorAll('.btn-main').forEach(btn => {
                            btn.classList.add('disabled');
                        })
                        this.status = 'installing';
                        this.messageDiv.querySelector('span').innerHTML = install_hint;
                        this.updateStatus();
                    }
                    setTimeout(function () {
                        self.detect_install("install");
                    }, 1000);
                } else if (app_prog_status == "failed" && flag != "init") {
                    if (`start_${this.appName}`.includes(ai_app_name)) {
                        this.messageDiv.querySelector('span').innerHTML = `<#Setting_live_ai_failed#>`;
                        this.messageDiv.querySelector('img').classList.add('d-none');
                        this.status = 'failed';
                        this.updateStatus();
                        this.installBtn.classList.remove('d-none');
                        document.querySelectorAll('.app-install-btn').forEach(btn => {
                            btn.classList.remove('disabled');
                        })
                        document.querySelectorAll('.btn-main').forEach(btn => {
                            btn.classList.remove('disabled');
                        })
                    }
                } else if (app_prog_status == "") {
                    if (`start_${this.appName}`.includes(ai_app_name)) {
                        this.messageDiv.querySelector('span').innerHTML = "";
                        this.status = 'not_installed';
                        this.updateStatus();
                        document.querySelectorAll('.app-install-btn').forEach(btn => {
                            btn.classList.remove('disabled');
                        })
                        document.querySelectorAll('.btn-main').forEach(btn => {
                            btn.classList.remove('disabled');
                        })
                    }
                } else if (app_prog_status == "DONE") {
                    if (flag != "init") {
                        if (`start_${this.appName}`.includes(ai_app_name)) {
                            document.querySelectorAll('.app-install-btn').forEach(btn => {
                                btn.classList.remove('disabled');
                            })
                            document.querySelectorAll('.btn-main').forEach(btn => {
                                btn.classList.remove('disabled');
                            })
                            this.messageDiv.querySelector('span').innerHTML = `<#Main_alert_processing#>`;
                            this.status = "running";
                            this.updateStatus();
                        }

                        setTimeout(function () {
                            let queryPost = {};
                            queryPost.action_mode = "apply";
                            queryPost.rc_service = "start_ai_request query";
                            httpApi.nvramSet(queryPost);
                        }, 3000);
                    }
                }
            } catch (e) {
                install_dead++;
                if (install_dead < 30)
                    setTimeout(function () {
                        self.detect_install(flag);
                    }, 1000);
                else {
                    this.messageDiv.querySelector('span').innerHTML = `<#Setting_live_ai_failed#>`;
                    this.status = "not_installed";
                    this.updateStatus();
                }
            }
        }
    }

    const container_list = {
        portainer: {
            name: 'formal-portainer-asus',
            displayName: 'Portainer',
        },
        adguard: {
            name: 'adguard-asus',
            displayName: 'AdGuard Home',
        },
        homeassistant: {
            name: 'homeassistant-asus',
            displayName: 'Home Assistant',
        },
        frigate: {
            name: 'formal-frigate-asus',
            displayName: 'FRIGATE',
        },
        'slm-cn-asus': {
            name: 'slm-cn-asus',
            displayName: 'slm'
        }
    };

    window.container_list = container_list;

    const get_ai_docker_date = async () => {
        return await httpApi.get_ai_docker_container();
    }

    get_ai_docker_date().then(async data => {
        const promises = Object.entries(container_list).map(async ([key, config]) => {
            const container_status = data.find(container => {
                return container.name === config.name
            });

            let installed = false;
            let status = 'not_installed';

            if (container_status) {
                const statusText = container_status.status.toLowerCase();
                if (key !== 'portainer') {
                    status = statusText.startsWith('up') ? 'running' : 'not_installed';
                } else {
                    status = statusText.startsWith('up') ? 'running' : 'stopped';
                }
                if (status === 'running') {
                    installed = true;
                }
            }

            config.container = new AppContainer({
                name: config.name,
                appName: key,
                displayName: config.displayName,
                status: status,
                installed: installed,
                openBtn: document.querySelector(`.app-open-btn[data-app='${key}']`),
                installBtn: document.querySelector(`.app-install-btn[data-app='${key}']`),
                enableBtn: key === 'portainer' ? document.getElementById("enable_portainer_btn") : undefined,
                messageDiv: document.querySelector(`.message[data-app='${key}']`)
            });

            //remove .more-action by model 
            if (!is_BE96_AI){
               document.querySelector('#card_portainer .more-action').classList.remove('d-none');
            }

            config.container.init();
            if (!installed) {
                await config.container.detect_install("init");
            }
        });

        await Promise.all(promises);

        // Check if any container has installed
        const hasInstalledContainer = Object.values(container_list).some(config =>
            config.container && config.container.status !== 'not_installed'
        );

        // if (hasInstalledContainer) {
        //     PolicyStatus()
        //         .then(data => {
        //             httpApi.log('aiboard_eula_status', JSON.stringify(data));
        //             if (data.AIBOARD_EULA < 1 || data.AIBOARD_EULA_read == 0) {
        //                 const policyModal = new PolicyModalComponent({
        //                     policy: "AIBOARD_EULA",
        //                     modalSize: "modal-lg",
        //                     agreeBtnText: "<#Acknowledge#>",
        //                     disagreeBtnText: "<#CTL_Decline#>",
        //                     showDisagreeBtn: false,
        //                     agreeCallback: () => {
        //                         let applyObj = {
        //                             AIBOARD_EULA: "1",
        //                         };
        //                         httpApi.nvramSet(applyObj, function () {
        //                             hideLoading();
        //                         });
        //                     },
        //                     disagreeCallback: () => {
        //
        //                     }
        //                 });
        //                 policyModal.show();
        //             }
        //         });
        // }
    });

    // Global variables
    let dead = 0;
    let install_dead = 0;

    // Global functions that need to be called from setTimeout strings
    function detect_firmware(flag) {
        try {
            const _nvram = httpApi.nvramGet([
                "webs_state_ai_update",
                "webs_state_ai_error",
                "webs_state_ai_info",
                "webs_state_ai_REQinfo",
                "webs_state_ai_flag",
                "webs_state_ai_upgrade"], true);
            const {
                webs_state_ai_update,
                webs_state_ai_error,
                webs_state_ai_info,
                webs_state_ai_REQinfo,
                webs_state_ai_flag,
                webs_state_ai_upgrade,
            } = _nvram;

            httpApi.log("check_update", `webs_state_ai_update: ${webs_state_ai_update}, webs_state_ai_error: ${webs_state_ai_error}, webs_state_ai_info: ${webs_state_ai_info}, webs_state_ai_REQinfo: ${webs_state_ai_REQinfo}, webs_state_ai_flag: ${webs_state_ai_flag}`);

            if (webs_state_ai_update === "0") {
                setTimeout(() => {
                    detect_firmware()
                }, 1000);
            } else {   // got fw info
                if (webs_state_ai_error === "1") {    //1:wget fail
                    document.getElementById('update_scan').style.display = "none";
                    document.getElementById('update_states').innerHTML = `<#Setting_live_ai_fwchk_failed#>`;
                } else {
                    document.getElementById('update_scan').style.display = "none";
                    document.getElementById('update_states').classList.add("new_fw_info");

                    if (webs_state_ai_flag === "2" || webs_state_ai_flag === "1") {
                        document.getElementById('update_states').innerHTML = `<#ADSL_FW_item3#> : ` + webs_state_ai_info;
                        document.getElementById("upgradeBtn").style.display = "";
                    } else {
                        document.getElementById('update_states').innerHTML = `<#is_ai_latest#>`;
                    }
                }
            }
        } catch (e) {
            dead++;
            if (dead < 30)
                setTimeout("detect_firmware();", 1000);
            else {
                document.getElementById('update_scan').style.display = "none";
                document.getElementById('update_states').innerHTML = "<#info_failed#>&nbsp;<#FW_n4#>";
            }
        }
    }

    let initPost = {};
    initPost.action_mode = "apply";
    initPost.rc_service = "start_ai_request query";
    await httpApi.nvramSet(initPost);


    // AiBoard Setting Block
    let rescueReturn_init = httpApi.get_aiboard_upgrade_status();
    let rescue_status_init = rescueReturn_init.retStatus;     //DOWNLOAD, PROGRESS|RUN, SUCCESS, DONE ; DOWNLOAD, LOAD, VERIFY, SUCCESS, DOCKER_DONE; failed
    let rescue_err_code_init = rescueReturn_init.retErrCode;
    const _init_nvram = await httpApi.nvramGet(["ai_fw_path", "territory_code"], true);
    const ai_fw_path_str = _init_nvram.ai_fw_path;
    const territory_code = _init_nvram.territory_code;
    const isCnSku = territory_code.search("CN") !== -1
    if (isCnSku) {
        document.getElementById("first-block").remove();
        document.getElementById("first-block-cn").classList.remove('d-none');
    } else {
        document.getElementById("first-block-cn").remove();
        document.getElementById("first-block").classList.remove('d-none');
    }

    const getAiboardInfoData = async () => {
        const data = await httpApi.nvramGet([
            "ai_hostname", "webs_state_ai_flag", "webs_state_ai_info",
        ], true);
        return {
            ai_hostname: data.ai_hostname || "",
            ai_webs_state_flag: data.webs_state_ai_flag || "0",
            webs_state_ai_info: data.webs_state_ai_info || "",
        }
    }
    getAiboardInfoData().then(nvramData => {    //Update setting info
        const {
            ai_hostname,
            ai_webs_state_flag,
            webs_state_ai_info,
        } = nvramData;

        if (ai_hostname !== "") {
            document.getElementById("ai_hostname").value = ai_hostname;
        }

        setTimeout(function () {
            const ai_fw_version_array = httpApi.nvramGet(["ai_sys_fw_version", "ai_buildno", "ai_sys_fw_commit_number", "ai_sys_fw_commit_hash", "ai_sys_sdk_commit_number", "ai_sys_sdk_commit_hash"], true);
            let ai_fw_version_str = ai_fw_version_array.ai_sys_fw_version + `.` + ai_fw_version_array.ai_buildno + `_` + ai_fw_version_array.ai_sys_fw_commit_number + `-g` + ai_fw_version_array.ai_sys_fw_commit_hash + `_` + ai_fw_version_array.ai_sys_sdk_commit_number + `-g` + ai_fw_version_array.ai_sys_sdk_commit_hash;
            document.getElementById("currentFwVer").innerText = ai_fw_version_str;
        }, 500);

        if (ai_webs_state_flag == "2" || ai_webs_state_flag == "1") {
            document.getElementById("upgradeBtn").style.display = "";
            document.getElementById("update_states").classList.add("new_fw_info");
            document.getElementById("update_states").innerText = `<#ADSL_FW_item3#> : ` + webs_state_ai_info;
        }

        // applyBtn click event
        const ApplyBtn = document.getElementById("applyBtn");
        ApplyBtn.addEventListener("click", () => {
            //valid hostname
            let alert_str = "";
            const aiHostname = document.getElementById("ai_hostname");
            const aiHostname_postfix = document.getElementById("ai_hostname_postfix");

            if (!aiHostname.disabled) {
                alert_str = validator.ai_host_name(aiHostname);
                if (alert_str !== "") {
                    const oldHint = document.getElementById("hint_ai_hostname");
                    if (oldHint) oldHint.remove();

                    const span = document.createElement("span");
                    span.id = "hint_ai_hostname";
                    span.textContent = alert_str;
                    span.style.marginLeft = "10px";
                    span.style.color = "rgb(0, 108, 225)";
                    span.style.fontSize = "13px";

                    aiHostname_postfix.insertAdjacentElement("afterend", span);
                    aiHostname.focus();
                }
            }
            if (alert_str !== "") {
                return;
            }

            let postObject = {};
            postObject.action_mode = "apply";
            postObject.rc_service = "start_ai_request apply";

            postObject.ai_portainer_enable = document.getElementById("enable_portainer_btn").classList.contains("active") ? "1" : "0";
            postObject.ai_hostname = document.getElementById("ai_hostname").value;

            let applyTime = 20;
            httpApi.nvramSet(postObject, function () {
                showLoading(applyTime);
                setTimeout(function () {
                    location.reload();
                }, applyTime * 1000);
            });
        });
    });

    //Ajax ai_prog_status to determine whether to display show_progress()
    //execute it while laoding this page
    if (ai_fw_path_str.includes("aisom_reset.swu")) { //rescue
        if (rescue_status_init != "" && rescue_status_init != "failed" && rescue_status_init != "DOCKER_DONE") {
            setTimeout(function () {
                let detailRescueLoader = null;
                detailRescueLoader = new AsusLoaderComponent({
                    id: 'loader',
                    type: 'rescueDetail',
                    seconds: null
                });
                top.loader = detailRescueLoader;

                detailRescueLoader.show_progress("rescue");
            }, 500);
        }
    } else if (ai_fw_path_str.includes("aisom.swu")) { //OTA
        if (rescue_status_init != "" && rescue_status_init != "failed" && rescue_status_init != "DONE") {
            setTimeout(function () {
                let detailLoader = null;
                detailLoader = new AsusLoaderComponent({
                    id: 'loader',
                    type: 'detail',
                    seconds: null
                });
                top.loader = detailLoader;

                detailLoader.show_progress("liveupdate");
            }, 500);
        }
    }

    if (aiboard_action === "rescue") {
        //`aiboard_action` from URL parameter to act something
        //console.log(`2:`+aiboard_action);
        applyRescue();
    }

    function reset_portainer() {
        let postObject = {};
        postObject.ai_app_name = "reset_portainer";
        postObject.action_mode = "apply";
        postObject.rc_service = "start_ai_request app";

        let resetTime = 40;
        httpApi.nvramSet(postObject, function () {
            showLoading(resetTime);

            setTimeout(function () {
                let queryPost = {};
                queryPost.action_mode = "apply";
                queryPost.rc_service = "start_ai_request query";
                httpApi.nvramSet(queryPost);
            }, (resetTime - 5) * 1000);

            setTimeout(function () {
                location.reload();
            }, resetTime * 1000);
        });
    }

    // reset_portainer_btn click event
    document.getElementById("reset_portainer_btn").addEventListener('click', () => reset_portainer());


    // checkBtn click event
    const checkBtn = document.getElementById("checkBtn");
    checkBtn.addEventListener("click", applyUpdate);

    function applyUpdate() {
        document.getElementById("checkBtn").classList.add('d-none');
        let postObject = {};
        postObject.action_mode = "apply";
        postObject.webs_update_trigger = "FWUG";
        postObject.rc_service = "start_webs_update";

        httpApi.nvramSet(postObject);
        document.getElementById('upgradeBtn').style.display = "none";
        document.getElementById('update_states').style.display = "";
        document.getElementById("update_states").classList.remove('new_fw_info');
        document.getElementById('update_states').innerHTML = "<#check_proceeding#>";
        document.getElementById('update_scan').style.display = "";

        setTimeout(() => detect_firmware(), 3000);
    }

    // upgradeBtn click event
    const upgradeBtn = document.getElementById("upgradeBtn");
    upgradeBtn.addEventListener("click", function () {
        applyDownloadUpgrade();
    });

    function applyDownloadUpgrade() {
        let detailLoader = null;
        detailLoader = new AsusLoaderComponent({
            id: 'loader',
            type: 'detail',
            seconds: null
        });
        top.loader = detailLoader;

        let postObject = {};
        postObject.action_mode = "apply";
        postObject.rc_service = "start_webs_ai_upgrade";
        httpApi.nvramSet(postObject, function () {
            detailLoader.show_progress('liveupdate');
        });
    }

    //Hide rescueBtn by model
    //if (!is_BE96_AI){
        document.querySelector('#card_rescuesetting .card-header').textContent = `<#Setting_upload_itemname#>`;
        document.querySelector('#card_rescuesetting .setting-rescue').classList.remove('d-none');
    //}

    // rescueBtn click event
    const rescueBtn = document.getElementById("rescueBtn");
    rescueBtn.addEventListener("click", function () {
        if (confirm(
`<#Setting_rescue_ai_Note0#>

<#Setting_rescue_ai_Note1#>
    • <#Setting_rescue_ai_Note1_1#>
    • <#Setting_rescue_ai_Note1_2#>
    • <#Setting_rescue_ai_Note1_3#>

<#Setting_rescue_ai_Note2#>

<#Setting_rescue_ai_confirm#>
`
        )) {
            applyRescue();
        }
    });

    function applyRescue() {
        let detailRescueLoader = null;
        detailRescueLoader = new AsusLoaderComponent({
            id: 'loader',
            type: 'rescueDetail',
            seconds: null
        });
        top.loader = detailRescueLoader;

        const now = new Date();
        const unixUTC = Math.floor(now.getTime() / 1000);
        let postObject = {};
        postObject.ai_rescue_ts = unixUTC;
        postObject.action_mode = "apply";
        postObject.rc_service = "start_webs_ai_rescue";
        httpApi.nvramSet(postObject, function () {
            detailRescueLoader.show_progress('rescue');
        });
    }

    // rebootBtn click event
    const rebootBtn = document.getElementById("rebootBtn");
    rebootBtn.addEventListener("click", function () {
        if(confirm(`<#Main_content_ai_reboot#>`)){
            applyReboot();
        }
    });
    let rebootTime = 60;

    function applyReboot() {
        let postObject = {};
        postObject.action_mode = "apply";
        postObject.rc_service = "start_ai_reboot";
        httpApi.nvramSet(postObject, function () {
            showLoading(rebootTime);
            setTimeout(function () {
                location.reload();
            }, rebootTime * 1000);
        });
    }

    // Router assistant input
    const assistantInput = document.getElementById('router-assistant-input');

    // AI tip hover typing animation
    const exampleInput = document.querySelector('.ai-example-input input');
    const exampleResult = document.querySelector('.ai-example-result');
    const exampleQuestion = document.getElementById('ai-example-question');
    const exampleAnswer = document.getElementById('ai-example-answer');
    let typingInterval = null;
    let currentTipText = '';

    const qaDatas = [];
    if (isCnSku) {
        const qaDatasTemp = [
            {
                question: `ROG 八爪魚 7 AI (GT-BE96 AI) 路由器华硕旗舰 WiFi 7 AI 游戏路由器的主要硬件和软件特性有哪些？`,
                answer: `ROG 八爪魚 7 AI (GT-BE96 AI) 配备四核 2.6GHz CPU，四核 Synaptics SL1680 CPU，7.9 TOPs NPU，4GB DDR4 内存，32GB eMMC 闪存；支持三频 WiFi 7，最高速率 19Gbps，支持多 VLAN，内嵌 Docker，AI 加速，适合高性能、智能家居和游戏场景。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `ROG 八爪魚 7 AI (GT-BE96 AI) 路由器的内存和存储规格是什么？`,
                answer: `ROG 八爪魚 7 AI (GT-BE96 AI) 配备四核 2.6GHz CPU，四核 Synaptics SL1680 CPU，7.9 TOPs NPU，4GB DDR4 内存，32GB eMMC 闪存；支持三频 WiFi 7，最高速率 19Gbps，支持多 VLAN，内嵌 Docker，AI 加速，适合高性能、智能家居和游戏场景。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `路由器助手可以做什么？`,
                answer: `我可以提供路由器系统状态简报，快速回答一些技术问题，并帮助执行部分操作。`
            },
            {
                question: `什么是 Adaptive QoE？AI 流量分析和动态带宽分配如何提升网络性能？`,
                answer: `Adaptive QoE 通过 AI 流量分析识别和分类游戏、视频、远程办公流量，动态分配带宽，优先关键任务，降低延迟和丢包，自动调整优化策略，适合高流量家庭、游戏玩家和远程办公场景。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `路由器中的 WiFi Insight 智能信道切换功能有什么好处？`,
                answer: `WiFi Insight 智能信道切换会持续监控并记录所有频段的信道变化，分析干扰源、设备连接和网络质量，主动推荐最佳信道设置，避免拥堵和干扰，提升多设备、智能家居和高流量场景下的 WiFi 稳定性和速度。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `ROG 八爪魚 7 AI (GT-BE96 AI) 路由器有哪些节能硬件和软件特性？`,
                answer: `ROG 八爪魚 7 AI (GT-BE96 AI) 采用高效电源管理芯片、低功耗元件和智能散热，支持智能无线功率调节、定时 WiFi、LED(灯)、USB 操作，AI 驱动动态节能，适合长期智能家居和多设备场景。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `AiMesh 是什么？`,
                answer: `AiMesh 是 ASUS 路由器的 Mesh 组网功能，可用多台 ASUS 路由器扩展 WiFi 覆盖。至少需两台兼容路由器，主路由器先联网，副路由器放在需要扩展的位置，按 AiMesh 按钮自动搜索主路由，按提示完成设置。AiMesh 支持无缝漫游和更优性能。`
            },
            {
                question: `ROG 八爪魚 7 AI (GT-BE96 AI) 路由器的以太网端口和配置是什么？`,
                answer: `ROG八爪魚 路由器配备 1 个 10G WAN/LAN 口，1 个 10G 游戏 LAN 口，1 个 2.5G WAN/LAN 口，3 个 2.5G LAN 口，1 个 1G LAN 口。详情请参考：[ROG 八爪魚 7 AI (GT-BE96 AI) 官方介绍](https://rog.asus.com/networking/rog-rapture-ROG 八爪魚 7 AI (GT-BE96 AI)/)。`
            },
            {
                question: `如何通过 Web GUI 设置 IoT 网络？`,
                answer: `进入路由器 Web 界面或 ASUS Router App，进入 [Network]，点击 IoT 网络，填写相关设置，点击应用完成。`
            },
            {
                question: `如何提升华硕路由器连接，减少玩网络游戏时的延迟？`,
                answer: `请开启Adaptive QoE（游戏模式）以优先处理游戏流量，建议设备使用有线连接而非WiFi。如果仍需使用WiFi，建议选择5GHz或6G(注意：中国大陆尚未开放 WiFi 6GHz），并将路由器放在开阔位置以减少干扰。`
            },
        ]
        qaDatas.push(...qaDatasTemp);
    } else {
        const qaDatasTemp = [
            {
                question: `What can 'Router assistant' do?`,
                answer: `I can provide a brief router system status report, quick answers for some technical questions and helps to do some actions.`
            },
            {
                question: `How do you set the ASUS router to wireless access point mode using the ASUS router app?`,
                answer: `Log in to the ASUS router app, go to Settings > System Settings > Operation Mode, select Access Point(AP) Mode, tap Apply, and follow the app instructions to complete the setup.`
            },
            {
                question: `How can I optimize my ASUS router connection to reduce lag when playing online games?`,
                answer: `Enable Adaptive QoE [game mode] to prioritize gaming traffic, connect your device via wired Ethernet instead of WiFi, if you still want to use WiFi, try to use 5GHz or 6GHz, and place router closer to your devices.`
            },
            {
                question: `Can I assign a preferred Uplink AP in an AiMesh system?`,
                answer: `Connect to the router via wired or WiFi and access the Web GUI using the router LAN IP or [ASUSWRT](http://www.asusrouter.com), log in with your credentials, go to AiMesh > Topology > Management > Uplink AP.`
            },
            {
                question: `What is the function and benefit of WiFi Insight smart channel switching in routers?`,
                answer: `WiFi Insight smart channel switching continuously monitors and records channel changes across all router bands, analyzes interference sources, device connections, and network quality...`
            },
            {
                question: `How to setup AiMesh system (Web GUI)?`,
                answer: `In app, Click Add button on the top-right corner and follow the instructions in app. On web GUI, navigate to AiMesh and click add AiMesh node.`
            },
            {
                question: `How many devices are currently connected to my network?`,
                answer: `Current number of connected devices: 10 (example)`
            },
            {
                question: `What steps can I take to improve slow WiFi speed on my ASUS router?`,
                answer: `Restart your router, ensure the router is placed in an open area, reduce interference from other electronic devices, disconnect unused devices, switch to a less congested WiFi channel.`
            },
            {
                question: `Can I use VPN on my router to access streaming services?`,
                answer: `You can set up a VPN client (VPN Fusion) on your ASUS router to route all devices or selected devices through the VPN and potentially access region-restricted streaming services.`
            },
            {
                question: `Will router assistants record my personal data?`,
                answer: `No, it does not record personal data.`
            }
        ]
        qaDatas.push(...qaDatasTemp);
    }

    const aiTipsContainer = document.getElementById('ai-tips');

    // Randomly select 3 questions
    const shuffled = [...qaDatas].sort(() => Math.random() - 0.5);
    const selectedQuestions = shuffled.slice(0, 3);

    selectedQuestions.forEach(qa => {
        const tip = document.createElement('div');
        tip.className = 'ai-tip';
        tip.textContent = qa.question;
        aiTipsContainer.appendChild(tip);
    });

    function typeText(text, callback) {
        let index = 0;
        exampleInput.value = '';

        clearInterval(typingInterval);

        typingInterval = setInterval(() => {
            if (index < text.length) {
                exampleInput.value += text[index];
                index++;
            } else {
                clearInterval(typingInterval);
                if (callback) callback();
            }
        }, 20);
    }

    function showAnswer(question) {
        const qaItem = qaDatas.find(qa => qa.question === question);
        const answer = qaItem ? qaItem.answer : "No answer available for this question.";
        exampleQuestion.textContent = question;
        exampleAnswer.textContent = answer;
        exampleResult.style.display = 'flex';
    }

    function hideAnswer() {
        exampleResult.style.display = 'none';
        exampleQuestion.textContent = '';
        exampleAnswer.textContent = '';
    }

    // Get all dynamically created tips
    const aiTips = document.querySelectorAll('.ai-tip');
    aiTips.forEach(tip => {
        tip.addEventListener('mouseenter', () => {
            const tipText = tip.textContent.trim();
            if (currentTipText !== tipText) {
                hideAnswer(); // Hide previous answer first
                clearInterval(typingInterval); // Stop any ongoing typing
                exampleInput.value = ''; // Clear text immediately
                currentTipText = tipText;
                typeText(tipText, () => {
                    // Show answer after typing is complete
                    setTimeout(() => {
                        showAnswer(tipText);
                    }, 500);
                });
            }
        });

        // Click event to submit question to router assistant
        tip.addEventListener('click', () => {
            const question = tip.textContent.trim();
            if (assistantInput) {
                assistantInput.value = question;
                assistantInput.focus();
                assistantInput.dispatchEvent(new KeyboardEvent('keydown', {key: 'Enter', bubbles: true}));
            }
        });
    });

    // Clear on mouse leave from all tips
    if (aiTipsContainer) {
        aiTipsContainer.addEventListener('mouseleave', () => {
            clearInterval(typingInterval);
            exampleInput.value = '';
            currentTipText = '';
            hideAnswer();
        });
    }

    // Mouse drag scroll functionality
    let isDown = false;
    let startX;
    let scrollLeft;

    aiTipsContainer.addEventListener('mousedown', (e) => {
        isDown = true;
        aiTipsContainer.style.cursor = 'grabbing';
        startX = e.pageX - aiTipsContainer.offsetLeft;
        scrollLeft = aiTipsContainer.scrollLeft;
    });

    aiTipsContainer.addEventListener('mouseleave', () => {
        isDown = false;
        aiTipsContainer.style.cursor = 'grab';
    });

    aiTipsContainer.addEventListener('mouseup', () => {
        isDown = false;
        aiTipsContainer.style.cursor = 'grab';
    });

    aiTipsContainer.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - aiTipsContainer.offsetLeft;
        const walk = (x - startX) * 2;
        aiTipsContainer.scrollLeft = scrollLeft - walk;
    });

    // Mouse wheel horizontal scroll
    aiTipsContainer.addEventListener('wheel', (e) => {
        e.preventDefault();
        aiTipsContainer.scrollLeft += e.deltaY;
    });


    // aiProtection
    const ark_adblock_init = await httpApi.nvramGet(["ark_adblock_enable"], true).ark_adblock_enable;
    const ark_adblock_switch = document.querySelector('#ark_adblock_switch');
    if (typeof ark_adblock_switch !== 'undefined' && ark_adblock_switch !== null) {

        if (ark_adblock_init == "1") {
            ark_adblock_switch.classList.add("active");
        } else {
            ark_adblock_switch.classList.remove("active");
        }
        ark_adblock_switch.addEventListener('click', () => {
            ark_adblock_switch.classList.toggle("active");
            const active = ark_adblock_switch.classList.contains("active");
            const value = active ? "1" : "0";
            showLoading();
            httpApi.nvramSet({
                "ark_adblock_enable": value,
                "wrs_protect_enable": "1",
                "action_mode": "apply",
                "rc_service": "restart_ark",
            }, () => {
                hideLoading();
            })
        });
    }

</script>
</body>
</html>
