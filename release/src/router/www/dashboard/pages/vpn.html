<html>
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0,  user-scalable=no" />
	</head>
	<style>
		:root {
			--tab-navigation-active-text: var(--black-alpha-100);
			--tab-navigation-active-primary: var(--primary-60, #C00);
			--tab-navigation-bg-color: var(--body-bg-color, #ededed);
			--tab-navigation-hover-bg: var(--black-alpha-3);
			--tab-navigation-text-color: var(--black-alpha-100);
		}
		[data-asuswrt-color="dark"] {
			--tab-navigation-bg-color: var(--body-bg-color, #181818);
			--tab-navigation-active-text: var(--white-alpha-100);
			--tab-navigation-active-primary: var(--primary-50, #F00);
			--tab-navigation-hover-bg: var(--white-alpha-5);
			--tab-navigation-text-color: var(--white-alpha-100);
		}

		.nav.nav-tabs {
			position: relative;
		}

		.nav.nav-tabs::after {
			content: '';
			position: absolute;
			top: 0;
			right: 0;
			width: 20px;
			height: 100%;
			background: linear-gradient(to right, transparent, var(--tab-navigation-bg-color));
			pointer-events: none;
			opacity: 0;
			transition: opacity 0.3s ease;
		}

		.nav.nav-tabs.scrollable::after {
			opacity: 1;
		}

		.tab-navigation {
			box-sizing: border-box;
			border-bottom: 1px solid var(--divider-strong);
			display: flex;
			align-items: center;
			background: var(--tab-navigation-bg-color);
			font-size: 1.2rem;
			font-family: inherit;
			font-weight: 500;
			letter-spacing: 0.01em;
			position: relative;
			overflow-x: auto !important;
			overflow-y: hidden !important;
			-webkit-overflow-scrolling: touch;
			scrollbar-width: none;
			-ms-overflow-style: none;
			flex-wrap: nowrap !important;
			scroll-behavior: smooth;
			cursor: grab;
		}

		.scrollable .tab-navigation {
			box-shadow: inset -10px 0 10px -10px rgba(0,0,0,0.1);
		}

		.tab-navigation::-webkit-scrollbar {
			display: none;
		}

		.tab-navigation__item {
			min-width: 180px;
			padding-left: 32px;
			padding-right: 32px;
			line-height: 40px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: none;
			border: none;
			font-size: inherit;
			font-family: inherit;
			color: var(--tab-navigation-text-color);
			cursor: pointer;
			border-bottom: 4px solid transparent;
			transition: color 0.2s, border-color 0.2s;
			font-weight: 400;
			flex: 0 0 auto;
			white-space: nowrap;
			outline: none;
		}
		.tab-navigation__item.active {
			color: var(--tab-navigation-active-text);
			font-weight: 700;
			border-bottom: 4px solid var(--tab-navigation-active-primary);
			border-radius: var(--radius-none) !important;
		}

		.tab-navigation__divider {
			width: 1px;
			height: 32px;
			background: var(--divide-stroke-color-default);
			margin: 0;
			display: inline-block;
			border-radius: 1px;
			flex-shrink: 0;
		}
		@media (max-width: 539px) {
			.tab-navigation {
				font-size: 1rem;
				padding: 1em 0 0.5em 0;
				padding-left: 16px !important;
				padding-right: 16px !important;
			}

			.tab-navigation__item {
				padding: 0 0.5em 0.2em 0.5em;
				min-width: 120px !important;
				font-size: 0.9rem !important;
			}

			.tab-navigation__divider {
				height: 1em;
				width: 1px;
				flex-shrink: 0;
			}
		}

		@media (max-width: 1023px) {
			.tab-navigation__item {
				flex: 0 0 auto;
				min-width: 150px;
			}
		}
		 @media (min-width: 1024px) {
			.tab-navigation__item {
				flex: 0 1 auto;
				min-width: var(--tab-item-min-width, auto);
				justify-content: center;
			}
		}
	</style>

	<body>
		<div class="row justify-content-center">
			<ul class="nav nav-tabs" id="vpnTabList" role="tablist"></ul>
			<div class="col-12 col-xxl-10 mb-3">
				<div class="pt-2 h-100">
					<iframe id="settingsWindow" style="
						width: 100%;
						height: 100vh;
						margin: 0 auto;
					"></iframe>
				</div>
			</div>
		</div>
	</body>

	<script>
		var webWrapper = true;
		if (typeof window.vpnTab === 'undefined') {
		    window.vpnTab = {
				config: [
					{ key: 'vpns', label: `<#BOP_isp_heart_item#>`, src: "/VPN/vpns.html", support: true },
					{ key: 'vpnc', label: `<#vpnc_title#>`, src: "/VPN/vpnc.html", support: isSupport("vpnc") },
					{ key: 'ig', label: `<#Instant_Guard_title#>`, src: "/pages/ig.html", support: isSupport("Instant_Guard") }
				],
				render() {
					const tabList = document.getElementById('vpnTabList');
					const supportedTabs = this.config.filter(tab => tab.support);
					if (supportedTabs.length <= 1) {
						tabList.style.display = 'none';
					} else {
						tabList.style.display = '';
						let navHtml = '<nav class="tab-navigation p-0" role="tablist">';
						supportedTabs.forEach((tab, idx) => {
							const isActive = idx === 0 ? 'active' : '';
							const ariaSelected = idx === 0 ? 'true' : 'false';
							const tabIndex = idx === 0 ? '0' : '-1';
							navHtml += `<button class="tab-navigation__item ${isActive}" role="tab" aria-selected="${ariaSelected}" aria-controls="tab-panel-${tab.key}" tabindex="${tabIndex}" data-tab="${tab.key}">${tab.label}</button>`;
							if (idx < supportedTabs.length - 1) {
								navHtml += '<span class="tab-navigation__divider" aria-hidden="true"></span>';
							}
						});
						navHtml += '</nav>';
						tabList.innerHTML = navHtml;
					}
					if (supportedTabs.length > 0) {
						const color = document.documentElement.getAttribute('data-asuswrt-color');
						const theme = document.documentElement.getAttribute('data-asuswrt-theme');
						$('#settingsWindow').css('visibility', 'hidden').attr('src', supportedTabs[0].src);
					}
				},
				bindEvents() {
					const tabSelector = '.tab-navigation__item';
					$('#vpnTabList').on('click', tabSelector, (e) => {
						if (window.tabDragTime && (Date.now() - window.tabDragTime < 150)) {
							e.preventDefault();
							return;
						}
						this.activateTab(e.target);
					});
					$('#vpnTabList').on('keydown', tabSelector, (e) => {
						const $tabs = $('#vpnTabList').find(tabSelector);
						const currentIdx = $tabs.index(e.target);
						let nextIdx = -1;
						if (e.key === 'ArrowRight') {
							nextIdx = (currentIdx + 1) % $tabs.length;
						} else if (e.key === 'ArrowLeft') {
							nextIdx = (currentIdx - 1 + $tabs.length) % $tabs.length;
						} else if (e.key === 'Home') {
							nextIdx = 0;
						} else if (e.key === 'End') {
							nextIdx = $tabs.length - 1;
						} else if (e.key === 'Enter' || e.key === ' ') {
							this.activateTab(e.target);
							e.preventDefault();
							return;
						} else {
							return;
						}
						$tabs.eq(nextIdx).focus();
						e.preventDefault();
					});
				},
				activateTab(tabEl) {
					const $tab = $(tabEl);
					$('.tab-navigation__item').removeClass('active').attr('aria-selected', 'false').attr('tabindex', '-1');
					$tab.addClass('active').attr('aria-selected', 'true').attr('tabindex', '0');
					const key = $tab.data('tab');
					const tab = this.config.find(t => t.key === key);
					if (tab) {
						$('#settingsWindow').css('visibility', 'hidden').attr('src', tab.src);
					}
				},
				init() {
					this.render();
					this.bindEvents();
					initTabScrolling();
				}
			};
			window.vpnTab.init();
		}
		else {
			window.vpnTab.init();
		}

		$("#settingsWindow")
			.on("load", function(){
				$(this).css("visibility", "visible").contents().find("body").hide();
				setTimeout(()=>{
					$("#settingsWindow").contents().find("body").css({"visibility":"visible"}).fadeIn();
				}, 200);
				const sendThemeColorMessage = () => {
					const theme = top.document.documentElement.getAttribute("data-asuswrt-theme");
					const color = top.document.documentElement.getAttribute("data-asuswrt-color");
					const iframe = document.getElementById("settingsWindow");
					if (iframe) {
						iframe.contentWindow.postMessage({theme, color}, "*");
					}
					window.parent.postMessage({theme, color}, "*");
				}
				sendThemeColorMessage();
			})

			window.addEventListener('message', event => {
				if (event.data.type === 'resize') {
					const iframe = document.getElementById('settingsWindow');
					if (iframe) {
						const footer = (navigator.userAgent.match(/ASUSMultiSiteManager/) || navigator.userAgent.match(/ASUSExpertSiteManager/)) ? 100 : 20;
						const iframeHeight = event.data.height + footer;
						let headerHeight = 0;
						if (document.querySelector('header')) {
							headerHeight = document.querySelector('header').scrollHeight;
						}
						const windowHeight = top.window.innerHeight - headerHeight * 2 - footer;
						iframe.style.height = `${Math.max(iframeHeight, windowHeight * 1.13)}px`
					}
				}
			});

		function initTabScrolling() {
			function checkScrollable() {
				const tabContainer = document.getElementById('vpnTabList');
				const tabNavigation = tabContainer?.querySelector('.tab-navigation');
				if (tabNavigation && tabContainer) {
					const isScrollable = tabNavigation.scrollWidth > tabNavigation.clientWidth;
					tabContainer.classList.toggle('scrollable', isScrollable);
				}
			}

			setTimeout(checkScrollable, 100);

			let isMouseDown = false, hasMoved = false, dragStartTime = 0;
			let startX = 0, startScrollLeft = 0;

			const tabNavigation = document.querySelector('.tab-navigation');
			if (!tabNavigation) return;

			const setTabNavStyle = (cursor, userSelect = '') => {
				tabNavigation.style.cursor = cursor;
				tabNavigation.style.userSelect = userSelect;
				tabNavigation.style.webkitUserSelect = userSelect;
				tabNavigation.style.mozUserSelect = userSelect;
				tabNavigation.style.msUserSelect = userSelect;
			};

			tabNavigation.addEventListener('wheel', function(e) {
				e.preventDefault();
				this.scrollLeft += (e.deltaY || e.deltaX) * 1.5;
			});

			tabNavigation.addEventListener('touchstart', function(e) {
				hasMoved = false;
				dragStartTime = Date.now();
				startX = e.touches[0].clientX;
				startScrollLeft = this.scrollLeft;
			});

			tabNavigation.addEventListener('mousedown', function(e) {
				if (e.which !== 1) return;

				isMouseDown = true;
				hasMoved = false;
				dragStartTime = Date.now();
				startX = e.clientX;
				startScrollLeft = this.scrollLeft;

				setTabNavStyle('grabbing', 'none');
				e.preventDefault();
			});

			const tabButtons = document.querySelectorAll('.tab-navigation__item');
			tabButtons.forEach((button) => {
				button.addEventListener('mousedown', function(e) {
					e.stopPropagation();

					if (e.which !== 1) return;

					isMouseDown = true;
					hasMoved = false;
					dragStartTime = Date.now();
					startX = e.clientX;
					startScrollLeft = tabNavigation.scrollLeft;

					setTabNavStyle('grabbing', 'none');
					e.preventDefault();
				});
			});

			tabNavigation.addEventListener('touchmove', function(e) {
				const clientX = e.touches[0].clientX;
				const diff = startX - clientX;

				if (Math.abs(diff) > 2) hasMoved = true;

				this.scrollLeft = startScrollLeft + diff * 1.5;
				e.preventDefault();
			});

			document.addEventListener('mousemove', function(e) {
				if (!isMouseDown) return;

				const diff = startX - e.clientX;

				if (Math.abs(diff) > 2) hasMoved = true;

				tabNavigation.scrollLeft = startScrollLeft + diff * 1.5;
				e.preventDefault();
			});

			document.addEventListener('mouseup', function() {
				if (isMouseDown) {
					isMouseDown = false;
					setTabNavStyle('grab');
					if (hasMoved) {
						window.tabDragTime = Date.now();
					}
					setTimeout(() => hasMoved = false, 50);
				}
			});

			tabNavigation.addEventListener('touchend', function() {
				if (hasMoved) {
					window.tabDragTime = Date.now();
				}
				setTimeout(() => hasMoved = false, 50);
			});

			tabNavigation.addEventListener('mouseenter', function() {
				if (!isMouseDown) setTabNavStyle('grab');
			});

			tabNavigation.addEventListener('mouseleave', function() {
				if (!isMouseDown) setTabNavStyle('default');
			});

			window.addEventListener('resize', () => {
				checkScrollable();
			});
		}
	</script>
</html>
