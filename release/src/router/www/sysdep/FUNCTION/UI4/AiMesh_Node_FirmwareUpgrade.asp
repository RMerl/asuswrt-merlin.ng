<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<html xmlns:v>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Expires" CONTENT="-1">
<link rel="shortcut icon" href="images/favicon.png">
<link rel="icon" href="images/favicon.png">
<title><#Web_Title#> - <#menu5_6_3#></title>
<link rel="stylesheet" type="text/css" href="index_style.css">
<link rel="stylesheet" type="text/css" href="form_style.css">
<link rel="stylesheet" type="text/css" href="css/confirm_block.css">
<script language="JavaScript" type="text/javascript" src="/js/jquery.js"></script>
<style>
.Bar_container{
	width:85%;
	height:21px;
	border:1px inset #999;
	margin:0 auto;
	margin-top:20px \9;
	background-color:#FFFFFF;
	z-index:100;
}
#proceeding_img_text{
	position:absolute; 
	z-index:101; 
	font-size:11px; color:#000000; 
	line-height:21px;
	width: 83%;
}
#proceeding_img{
	height:21px;
	background: #D7E8F4;
	background: -webkit-linear-gradient(#F2F7EB 0%, #E4E6EE 49%, #C8D3Db 50%, #BACEDA 51%, #D7E8F4 100%);
	background: -o-linear-gradient(#F2F7EB 0%, #E4E6EE 49%, #C8D3Db 50%, #BACEDA 51%, #D7E8F4 100%);
	background: linear-gradient(#F2F7EB 0%, #E4E6EE 49%, #C8D3Db 50%, #BACEDA 51%, #D7E8F4 100%);
}
.icon_logo {
	background: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2278%22%20height%3D%2216%22%20fill%3D%22none%22%20viewBox%3D%220%200%2078%2016%22%3E%3Cg%20id%3D%22Group%22%3E%3Cg%20id%3D%22logo-001%201%22%20clip-path%3D%22url(%23clip0_3231_54081)%22%3E%3Cpath%20id%3D%22Vector_____0_0_IPMZGMXGWB%22%20fill%3D%22%232D2926%22%20d%3D%22M37.824%200H24.159C20.991%200%2019.582%201.983%2019.264%203.872V0H11.68C10.622%200%2010.111%200.321%209.6%201.057L7.52%204.097H37.825V0H37.824ZM0%2016H5.44L12.256%204.991L7.392%204.511L0%2016ZM43.105%200H38.625V4.097H43.105V0V0ZM71.54%206.4L57.522%205.568C57.522%207.713%2058.932%209.154%2061.332%209.344L71.315%2010.11C72.081%2010.176%2072.561%2010.366%2072.561%2011.009C72.561%2011.617%2072.015%2011.841%2070.896%2011.841H57.297V16H71.187C75.57%2016%2077.491%2014.463%2077.491%2010.974C77.491%207.841%2075.764%206.656%2071.539%206.401L71.54%206.4Z%22%2F%3E%3Cpath%20id%3D%22Vector_____0_1_EZQCLJZIEV%22%20fill%3D%22%232D2926%22%20d%3D%22M57.344%205.568L52.929%205.313V10.017C52.929%2011.489%2052.194%2011.938%2049.634%2011.938H46.114C44.004%2011.938%2043.106%2011.33%2043.106%2010.018V4.868L38.626%204.546V10.401H38.529C38.273%208.705%2037.634%206.722%2033.375%206.431L19.36%205.503C19.36%207.649%2020.897%208.926%2023.298%209.182L33.056%2010.173C33.823%2010.235%2034.4%2010.46%2034.4%2011.103C34.4%2011.807%2033.823%2011.869%2032.928%2011.869H19.2V5.471L14.72%205.185V16H32.957C37.019%2016%2038.332%2013.89%2038.526%2012.128H38.622C39.133%2014.912%2041.564%2016%2045.692%2016H50.234C55.067%2016%2057.34%2014.529%2057.34%2011.07V5.569H57.344V5.568ZM77.181%204.097V0H62.141C59.009%200%2057.599%201.94%2057.351%203.81C57.3465%203.83172%2057.3442%203.85382%2057.344%203.876V0H52.929V4.097H77.181Z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3Cdefs%3E%3CclipPath%20id%3D%22clip0_3231_54081%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M0%200H78V16H0z%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3C%2Fsvg%3E");
	background-repeat: no-repeat;
	background-size: 80%;
    width: 30%;
    height: 15%;
    background-position: center;
}
.desc_container {
	margin-top: 2%;
	font-family: Helvetica, Arial;
	font-size: 16pt;
	color: #262626;
	text-align: left;
	font-weight: bolder;
}
.AiMesh_fw_upload_bg {
	position: absolute;
	right: 0;
	top: 0;
	left: 0;
	bottom: 0;
	margin: auto;
	width: 80%;
	height: 90%;
	display: flex;
	flex-direction: column;
	justify-content: flex-start;
	align-items: center;
	min-width: 340px;
}
.AiMesh_fw_loading {
	position: relative;
	top: 20%;
	margin: auto;
}
.fw_upload_button {
	background-color: #fff;
	border-radius: 50px;
	height: 7vh;
	width: 35%;
	font-size: 4vh;
	color: #006ce1;
	border: 1px solid #006ce1;
	text-align: center;
	line-height: 7vh;
	cursor: pointer;
	margin-top: 2%;
}
/*for mobile device*/
@media screen and (orientation: portrait) and (max-width: 1000px) {
	.icon_logo {
		width: 50%;
		height: 10%;
		margin: 0 auto;
		background-position: center;
	}
	.desc_container {
		width: 50%;
		font-size: 5vw;
		text-align: center;
		margin: 2vh auto;
	}
	.fw_upload_button {
		height: 5vh;
		font-size: 3vh;
		line-height: 5vh;
		margin: 0 auto;
	}
}
@media screen and (orientation: landscape) and (max-width: 1000px) {
	.icon_logo {
		width: 50%;
		height: 15%;
		margin: 0 auto;
		background-position: center;
	}
	.desc_container {
		width: 50%;
		font-size: 7vw;
		text-align: center;
		margin: 2% auto;
	}
	.fw_upload_button {
		width: 50%;
		margin: 0 auto;
	}
}
</style>
<script>
function isSupport(_ptn){
	var ui_support = [<% get_ui_support(); %>][0];
	return (ui_support[_ptn]) ? ui_support[_ptn] : 0;
}
var odm_support = isSupport("odm");
function initial() {
	if(odm_support)
		document.body.className = "bg-odm";
	else
		document.body.className = "bg";
}
function dr_advise() {
	htmlbodyforIE = document.getElementsByTagName("html");  //this both for IE&FF, use "html" but not "body" because <!DOCTYPE html PUBLIC.......>
	htmlbodyforIE[0].style.overflow = "hidden";	  //hidden the Y-scrollbar for preventing from user scroll it.

	document.getElementById("hiddenMask").style.width = "100%";
	document.getElementById("hiddenMask").style.height = "100%";
	document.getElementById("hiddenMask").style.visibility = "visible";
}
function cancel_dr_advise(){
	document.getElementById("hiddenMask").style.visibility = "hidden";
	htmlbodyforIE = parent.document.getElementsByTagName("html");  //this both for IE&FF, use "html" but not "body" because <!DOCTYPE html PUBLIC.......>
	htmlbodyforIE[0].style.overflow = "scroll";	  //hidden the Y-scrollbar for preventing from user scroll it.	
	window.scrollTo(0, 0);//x-axis , y-axis	
}

function submitForm(){
	var check_zip = function(obj) {
		var reg = new RegExp("^.*.(zip|ZIP|rar|RAR|7z|7Z)$", "gi");
		if(reg.test(obj.value)){
			alert("<#FW_note_unzip#>");
			obj.focus();
			obj.select();
			return false;
		}
		else
			return true;
	};

	if(!check_zip(document.form.file))
		return;
	else {
		document.form.action_mode.value = "Upload1";
		if(document.form.file.value){
			dr_advise();
			document.form.submit();
		}
		else{
			alert("<#JS_Shareblanktest#>");
			document.form.file.focus();
		}

	}
}

function LoadingProgress(seconds) {
	document.getElementById("LoadingBar").style.visibility = "visible";
	y = y + progress;
	if(typeof(seconds) == "number" && seconds >= 0){
		if(seconds != 0){
			document.getElementById("proceeding_img").style.width = Math.round(y) + "%";
			document.getElementById("proceeding_img_text").innerHTML = Math.round(y) + "%";

			if(document.getElementById("loading_block1")){
				document.getElementById("proceeding_img_text").style.width = document.getElementById("loading_block1").clientWidth;
				document.getElementById("proceeding_img_text").style.marginLeft = "175px";
			}
			--seconds;
			setTimeout("LoadingProgress("+seconds+");", 1000);
		}
		else{
			document.getElementById("proceeding_img_text").innerHTML = "<#Main_alert_proceeding_desc3#>";
			y = 0;
			if(location.pathname.indexOf("AiMesh_Node_FirmwareUpgrade") < 0) {
				setTimeout("hideLoadingBar();",1000);
				window.open(location, '_self').close();
			}
		}
	}
}

function showLoadingBar(seconds) {
	if(window.scrollTo)
		window.scrollTo(0,0);
	
	htmlbodyforIE = document.getElementsByTagName("html");  //this both for IE&FF, use "html" but not "body" because <!DOCTYPE html PUBLIC.......>
	htmlbodyforIE[0].style.overflow = "hidden";	  //hidden the Y-scrollbar for preventing from user scroll it.

	document.getElementById("LoadingBar").style.width = "100%";
	document.getElementById("LoadingBar").style.height = "100%";

	loadingSeconds = seconds;
	progress = 100/loadingSeconds;
	y = 0;
	LoadingProgress(seconds);
}
function hideLoadingBar(){
	document.getElementById("LoadingBar").style.visibility = "hidden";
}

var dead = 0;
function detect_httpd() {
	$.ajax({
		url: '/httpd_check.xml',
		dataType: 'xml',
		timeout: 1500,
		error: function(xhr) {
			if(dead > 5) {
				document.getElementById('loading_block1').style.display = "none";
				document.getElementById('loading_block2').style.display = "none";
				document.getElementById('loading_block3').style.display = "";
				document.getElementById('loading_block3').innerHTML = "<div><#FIRM_ok_aimesh#></div>";
				document.getElementById('tr_closeWindow').style.display = "";
			}
			else {
				dead++;
			}
			setTimeout("detect_httpd();", 1000);
		},

		success: function(){
			document.getElementById('loading_block1').style.display = "none";
			document.getElementById('loading_block2').style.display = "none";
			document.getElementById('loading_block3').style.display = "";
			document.getElementById('loading_block3').innerHTML = "<div><#FIRM_ok_aimesh#></div>";
			document.getElementById('tr_closeWindow').style.display = "";
		}
	});
}
function closeWindow() {
	window.open(location, '_self').close();
}
function open_AiMesh_node_fw_upgrade() {
	document.form.file.click();
}
</script>
</head>
<body onload="initial();">
<div id="LoadingBar" class="popup_bar_bg">
<table cellpadding="5" cellspacing="0" id="loadingBarBlock" class="loadingBarBlock AiMesh_fw_loading" align="center">
	<tr>
		<td height="80">
			<div id="loading_block1" class="Bar_container">
				<span id="proceeding_img_text"></span>
				<div id="proceeding_img"></div>
			</div>
			<div id="loading_block2" style="margin:5px auto; width:85%;"><#FIRM_ok_desc#><br><#Main_alert_proceeding_desc5#></div>
			<div id="loading_block3" style="margin:5px auto;width:85%; font-size:12pt;"></div>
		</td>
	</tr>
	<tr id="tr_closeWindow" style="display:none;text-align:center;">
		<td>
			<input type="button" class="button_gen" style="margin-bottom:10px;" onclick="closeWindow()" value="<#CTL_close#>" />
		</td>
	</tr>
</table>
<!--[if lte IE 6.5]><iframe class="hackiframe"></iframe><![endif]-->
</div>
<div id="Loading" class="popup_bg"></div><!--for uniform show, useless but have exist-->

<div id="hiddenMask" class="popup_bg">
	<table cellpadding="5" cellspacing="0" id="dr_sweet_advise" class="dr_sweet_advise AiMesh_fw_loading" align="center" style="height:100px;">
		<tr>
		<td>
			<div class="drword" id="drword" style="">&nbsp;&nbsp;&nbsp;&nbsp;<#Main_alert_proceeding_desc4#> <#Main_alert_proceeding_desc1#>...</div>
		</td>
		</tr>
	</table>
<!--[if lte IE 6.5]><iframe class="hackiframe"></iframe><![endif]-->
</div>

<iframe name="hidden_frame" id="hidden_frame" src="" width="0" height="0" frameborder="0"></iframe>

<form method="post" action="upgrade.cgi" name="form" target="hidden_frame" enctype="multipart/form-data">
<input type="hidden" name="current_page" value="AiMesh_fw_upgrade.asp">
<input type="hidden" name="next_page" value="">
<input type="hidden" name="action_mode" value="">
<input type="hidden" name="action_script" value="">
<input type="hidden" name="action_wait" value="">
<input type="hidden" name="preferred_lang" id="preferred_lang" value="<% nvram_get("preferred_lang"); %>">
<input type="hidden" name="firmver" value="<% nvram_get("firmver"); %>">
<input type="hidden" name="update" disabled>
<input type="hidden" name="upload" disabled>
<div class='AiMesh_fw_upload_bg'>
	<div class="icon_logo">
	</div>
	<div class="desc_container">
		<#FW_item5#>
	</div>
	<div class="fw_upload_button" onclick="open_AiMesh_node_fw_upgrade()"><#CTL_upload#></div>
	<input type="file" name="file" class="input" style="display:none;" onchange='submitForm();'>
<div>
</form>
</body>
</html>
